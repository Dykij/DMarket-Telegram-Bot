# Development-specific Docker Compose for Dev Container
# Extends docker-compose.yml with development features

services:
  bot-dev:
    build:
      context: ..
      dockerfile: Dockerfile.dev
    container_name: dmarket-bot-dev
    volumes:
      - ..:/app:cached
      - ~/.gitconfig:/home/vscode/.gitconfig:ro
      - ~/.ssh:/home/vscode/.ssh:ro
    environment:
      - PYTHONPATH=/app
      - PYTHONDONTWRITEBYTECODE=1
      - LOG_LEVEL=DEBUG
      - DRY_RUN=true
      # MCP Server integration
      - CONTEXT7_API_KEY=${CONTEXT7_API_KEY}
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - SKILLSMP_API_KEY=${SKILLSMP_API_KEY}
    command: sleep infinity
    networks:
      - bot-network
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    ports:
      - "8080:8080" # Health check
      - "5678:5678" # n8n debugging

  # Override postgres for dev (with persistent data)
  postgres:
    volumes:
      - postgres_dev_data:/var/lib/postgresql/data
      - ../scripts/init_db.sql:/docker-entrypoint-initdb.d/init.sql

  # Override redis for dev
  redis:
    volumes:
      - redis_dev_data:/data

volumes:
  postgres_dev_data:
  redis_dev_data:
