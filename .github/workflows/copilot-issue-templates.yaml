name: Copilot Issue Templates
on:
  issues:
    types: [opened, labeled]

permissions:
  issues: write
  pull-requests: write

jobs:
  auto-assign-copilot:
    runs-on: ubuntu-latest
    if: contains(github.event.issue.labels.*.name, 'copilot-task')

    steps:
      - name: Auto-assign Copilot
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;

            // –ù–∞–∑–Ω–∞—á–∏—Ç—å –Ω–∞ Copilot
            await github.rest.issues.addAssignees({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              assignees: ['copilot']
            });

            // –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
            const comment = `
            ü§ñ **Copilot Coding Agent –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω**

            –ê–≥–µ–Ω—Ç –Ω–∞—á–Ω–µ—Ç —Ä–∞–±–æ—Ç—É –Ω–∞–¥ —ç—Ç–æ–π –∑–∞–¥–∞—á–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

            **–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç:**
            1. –ê–Ω–∞–ª–∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è issue
            2. –°–æ–∑–¥–∞–Ω–∏–µ draft PR —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
            3. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∏ –ª–∏–Ω—Ç–µ—Ä–æ–≤
            4. –ó–∞–ø—Ä–æ—Å —Ä–µ–≤—å—é —É –∞–≤—Ç–æ—Ä–∞ issue

            **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ:**
            - –í–µ—Ç–∫–∞: \`copilot/issue-${issue.number}\`
            - –õ–æ–≥–∏: GitHub Actions ‚Üí Copilot Agent workflows

            **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
            - \`@copilot pause\` - –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞–±–æ—Ç—É
            - \`@copilot resume\` - –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å
            - \`@copilot <–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è>\` - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

            ---
            üìö [–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ](.github/COPILOT_AGENT_GUIDE.md)
            `;

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              body: comment
            });

  label-by-title:
    runs-on: ubuntu-latest
    if: github.event.action == 'opened'

    steps:
      - name: Auto-label by keywords
        uses: actions/github-script@v7
        with:
          script: |
            const title = context.payload.issue.title.toLowerCase();
            const labels = [];

            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
            if (title.includes('test') || title.includes('coverage')) {
              labels.push('copilot-test');
            }
            if (title.includes('refactor') || title.includes('optimize')) {
              labels.push('copilot-refactor');
            }
            if (title.includes('docs') || title.includes('documentation')) {
              labels.push('copilot-docs');
            }
            if (title.includes('security') || title.includes('vulnerability')) {
              labels.push('copilot-security');
            }
            if (title.includes('bug') || title.includes('fix')) {
              labels.push('copilot-bugfix');
            }

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–µ—Ç–∫–∞ –¥–ª—è Copilot tasks
            if (title.startsWith('@copilot') || title.includes('copilot:')) {
              labels.push('copilot-task');
            }

            if (labels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number,
                labels: labels
              });
            }
