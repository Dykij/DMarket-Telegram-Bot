# Code Analysis - Linting, Types, Security, Complexity
name: Code Analysis

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]
  workflow_dispatch:

permissions:
  contents: read
  security-events: write
  pull-requests: write

jobs:
  analyze:
    name: "ðŸ”¬ Deep Analysis"
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v6
        with:
          fetch-depth: 1
      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
          cache: pip
      - name: Install
        run: pip install -q ruff mypy bandit safety vulture radon
      - name: Ruff
        run: ruff check src/ tests/ --output-format=concise | head -20 || true
        continue-on-error: true
      - name: MyPy
        run: mypy src/ --ignore-missing-imports --no-error-summary | head -20 || true
        continue-on-error: true
      - name: Bandit
        run: bandit -r src/ -f json -o bandit.json -q || true
        continue-on-error: true
      - name: Vulture
        run: vulture src/ --min-confidence 90 | head -10 || true
        continue-on-error: true
      - name: Complexity
        run: radon cc src/ -a -s | head -20 || true
        continue-on-error: true
      - uses: actions/upload-artifact@v6
        if: always()
        with:
          name: analysis-reports
          path: "*.json"
          retention-days: 7
          if-no-files-found: ignore
