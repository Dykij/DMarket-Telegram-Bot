# üó∫Ô∏è Roadmap - –ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è DMarket-Telegram-Bot

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2026-01-08
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2026-01-08
**–í–µ—Ä—Å–∏—è Python**: 3.12.3
**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å**: ‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|---------|----------|--------|
| **–¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω–æ** | 4924+ | üü¢ |
| **–¢–µ—Å—Ç—ã –ø—Ä–æ–≤–∞–ª–µ–Ω–æ** | 0 | üü¢ |
| **–¢–µ—Å—Ç—ã –ø—Ä–æ–ø—É—â–µ–Ω–æ** | 24 | ‚ö†Ô∏è |
| **Ruff warnings** | 0 | üü¢ |
| **CodeQL alerts** | 0 | üü¢ |

---

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û - –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ PLR1702, PLR0904, PLR0917

### –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ deep nesting (PLR1702)

**–§–∞–π–ª—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥**:
- `src/dmarket/adaptive_polling.py` - –∏–∑–≤–ª–µ—á–µ–Ω—ã `_execute_poll_cycle()` –∏ `_process_changes()` –º–µ—Ç–æ–¥—ã
- `src/dmarket/backtester.py` - –∏–∑–≤–ª–µ—á–µ–Ω—ã `_process_timestamp()` –∏ `_evaluate_and_execute_buy()` –º–µ—Ç–æ–¥—ã
- `src/dmarket/intramarket_arbitrage.py` - –∏–∑–≤–ª–µ—á–µ–Ω—ã `_find_group_anomalies()` –∏ `_check_item_pair_anomaly()` —Ñ—É–Ω–∫—Ü–∏–∏

**–§–∞–π–ª—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ noqa**:
- `src/dmarket/intramarket_arbitrage.py` - `try: # noqa: PLR1702` (find_trending_items)
- `src/dmarket/realtime_price_watcher.py` - `for game, item_ids in items_by_game.items(): # noqa: PLR1702`
- `src/dmarket/sniper_cycle.py` - `try: # noqa: PLR1702`
- `src/telegram_bot/handlers/panic_handler.py` - `try: # noqa: PLR1702`
- `src/telegram_bot/smart_notifications/checkers.py` - `for user_id_str, alerts in active_alerts_.items(): # noqa: PLR1702`

### Too many public methods (PLR0904)

**–§–∞–π–ª—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ noqa**:
- `src/dmarket/dmarket_api.py` - `class DMarketAPI: # noqa: PLR0904` (50 –º–µ—Ç–æ–¥–æ–≤ - API —Ç—Ä–µ–±—É–µ—Ç –º–Ω–æ–≥–æ endpoints)
- `src/utils/database.py` - `class DatabaseManager: # noqa: PLR0904` (22 –º–µ—Ç–æ–¥–∞ - CRUD –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π)
- `src/waxpeer/waxpeer_api.py` - `class WaxpeerAPI: # noqa: PLR0904` (23 –º–µ—Ç–æ–¥–∞ - API —Ç—Ä–µ–±—É–µ—Ç –º–Ω–æ–≥–æ endpoints)

### Too many positional arguments (PLR0917)

**–§–∞–π–ª—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ noqa**:
- `src/dmarket/api/market.py` - `async def list_market_items(# noqa: PLR0917` (API-–º–µ—Ç–æ–¥ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤)
- `src/dmarket/dmarket_api.py` - `async def get_market_items(# noqa: PLR0917` (API-–º–µ—Ç–æ–¥ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤)
- `src/utils/audit_logger.py` - `async def log(# noqa: PLR0917` (–∞—É–¥–∏—Ç-–º–µ—Ç–æ–¥ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –ø–æ–ª–µ–π)

### Security warnings (by design)

**Pickle –¥–ª—è ML –º–æ–¥–µ–ª–µ–π (S403/S301)**:
- `src/ml/enhanced_predictor.py` - `import pickle # noqa: S403` –∏ `pickle.load(f) # noqa: S301`
- `src/ml/price_predictor.py` - `import pickle # noqa: S403` –∏ `pickle.load(f) # noqa: S301`
- **–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**: Pickle –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ sklearn –º–æ–¥–µ–ª–µ–π. –§–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.

**Bind to all interfaces (S104)**:
- `src/telegram_bot/health_check.py` - `host: str = "0.0.0.0" # noqa: S104` (x2)
- `src/telegram_bot/webhook.py` - `listen: str = "0.0.0.0" # noqa: S104` (x2)
- **–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**: –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö, –≥–¥–µ –≤–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—É—é —Å–µ—Ç—å.

**Subprocess –≤ watchdog (S404/S603/ASYNC220)**:
- `src/utils/watchdog.py` - `import subprocess # noqa: S404` –∏ `subprocess.Popen # noqa: ASYNC220, S603`
- **–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**: Watchdog —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º –≥–ª–∞–≤–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞. –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç—Å—è –∏ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥.

**Async Path read (ASYNC240)**:
- `src/telegram_bot/webhook.py` - `read_bytes() # noqa: ASYNC240`
- **–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**: –ß—Ç–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ. Async –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

---

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (P0 ‚Üí DONE)

**–§–∞–π–ª**: `tests/dmarket/test_dmarket_api_phase4_part1.py`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**:
- `test_cache_cleanup_on_overflow` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å "long" TTL –¥–ª—è overflow_key
- Cleanup —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø–æ expire_time, –ø–æ—ç—Ç–æ–º—É overflow_key —Å –∫–æ—Ä–æ—Ç–∫–∏–º TTL —É–¥–∞–ª—è–ª—Å—è –ø–µ—Ä–≤—ã–º
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ —á—Ç–æ —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ (key_0..key_99) —É–¥–∞–ª—è—é—Ç—Å—è, –∞ –Ω–æ–≤—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ 36 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç

---

## üü† P1 - –í–∞–∂–Ω—ã–µ (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)

### 2. –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å 24 –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞

**–°—Ç–∞—Ç—É—Å**: ‚è∏Ô∏è –û—Ç–ª–æ–∂–µ–Ω–æ - —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (structlog, numpy –∏ —Ç.–¥.)

**–§–∞–π–ª—ã**:
- `tests/telegram_bot/notifications/test_notification_handlers.py` - 12 —Ç–µ—Å—Ç–æ–≤
- `tests/dmarket/api/test_auth.py` - 6 —Ç–µ—Å—Ç–æ–≤
- `tests/telegram_bot/test_telegram_bot_modules.py` - 2 —Ç–µ—Å—Ç–∞
- `tests/dmarket/api/test_inventory.py` - 2 —Ç–µ—Å—Ç–∞

**–ü—Ä–∏—á–∏–Ω—ã**:
- –°–ª–æ–∂–Ω—ã–π module patching —Ç—Ä–µ–±—É–µ—Ç—Å—è
- Fixtures –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã (tests moved to other modules)
- API –∏–∑–º–µ–Ω–∏–ª—Å—è (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É–¥–∞–ª–µ–Ω—ã)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:
- –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ç–µ—Å—Ç—ã –∏–ª–∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –∫ –Ω–æ–≤–æ–º—É API

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –°—Ä–µ–¥–Ω–∏–π
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –í—ã—Å–æ–∫–∞—è
**–í—Ä–µ–º—è**: ~4-6 —á–∞—Å–æ–≤

---

### 3. ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω deprecated datetime.utcfromtimestamp

**–§–∞–π–ª—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã**:
- `src/ml/feature_extractor.py` (—Å—Ç—Ä–æ–∫–∞ 279)
- `src/ml/enhanced_predictor.py` (—Å—Ç—Ä–æ–∫–∞ 471)

**–ë—ã–ª–æ**:
```python
datetime.utcfromtimestamp(sale_time)
```

**–°—Ç–∞–ª–æ**:
```python
datetime.fromtimestamp(sale_time, tz=UTC)
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

---

## üü† P1 - –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### 4. –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å 24 –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞

**–°—Ç–∞—Ç—É—Å**: ‚è∏Ô∏è –û—Ç–ª–æ–∂–µ–Ω–æ - —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (structlog, numpy –∏ —Ç.–¥.)

**–§–∞–π–ª—ã**:
- `tests/telegram_bot/notifications/test_notification_handlers.py` - 12 —Ç–µ—Å—Ç–æ–≤
- `tests/dmarket/api/test_auth.py` - 6 —Ç–µ—Å—Ç–æ–≤
- `tests/telegram_bot/test_telegram_bot_modules.py` - 2 —Ç–µ—Å—Ç–∞
- `tests/dmarket/api/test_inventory.py` - 2 —Ç–µ—Å—Ç–∞

**–ü—Ä–∏—á–∏–Ω—ã**:
- –°–ª–æ–∂–Ω—ã–π module patching —Ç—Ä–µ–±—É–µ—Ç—Å—è
- Fixtures –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã (tests moved to other modules)
- API –∏–∑–º–µ–Ω–∏–ª—Å—è (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É–¥–∞–ª–µ–Ω—ã)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:
- –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ç–µ—Å—Ç—ã –∏–ª–∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –∫ –Ω–æ–≤–æ–º—É API

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –°—Ä–µ–¥–Ω–∏–π
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –í—ã—Å–æ–∫–∞—è
**–í—Ä–µ–º—è**: ~4-6 —á–∞—Å–æ–≤

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ | –¶–µ–ª—å | –î–µ–¥–ª–∞–π–Ω |
|---------|---------|------|---------|
| Tests passed | 4924+ | 4948+ | 2 –Ω–µ–¥–µ–ª–∏ |
| Tests failed | 0 | 0 | ‚úÖ |
| Tests skipped | 24 | 10 | 1 –º–µ—Å—è—Ü |
| Ruff warnings | 0 | 0 | ‚úÖ |
| Code coverage | ~80% | 85%+ | 1 –º–µ—Å—è—Ü |

---

## üîß –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pytest tests/ -v --tb=short

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Ruff
ruff check src/ --statistics

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
mypy src/ --ignore-missing-imports

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è
pytest tests/ --cov=src --cov-report=html

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ dev —Ä–µ–∂–∏–º–µ
python -m src.main --debug
```

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (–∞—Ä—Ö–∏–≤)

### –ò–∑ —Ñ–∞–π–ª–∞ BM:
- [x] P0: connection pooling, keyboards, commands, bot_commands
- [x] P1: notification checker, callback handlers
- [x] P1+: storage tests, alerts tests, notification handlers
- [x] P2: ML modules (38 features), datetime.now(UTC)

### –ò–∑ —Ñ–∞–π–ª–∞ ISPRAV:
- [x] P0: test_notifier (17 —Ç–µ—Å—Ç–æ–≤), test_initialization (3 —Ç–µ—Å—Ç–∞), test_telegram_bot_modules (2 —Ç–µ—Å—Ç–∞)
- [x] P1: test_adaptive_polling (1 —Ç–µ—Å—Ç), test_smart_notifier (1 —Ç–µ—Å—Ç), test_dmarket_api_phase4_part1 (—á–∞—Å—Ç–∏—á–Ω–æ)
- [x] P2: 37 Ruff auto-fixes (577 ‚Üí 35 warnings)

### –ò–∑ Roadmap:
- [x] P1: deprecated datetime.utcfromtimestamp ‚Üí datetime.fromtimestamp(tz=UTC) (2 —Ñ–∞–π–ª–∞)
- [x] P2: A006 lambda builtin shadowing ‚Üí renamed `id` to `item_id_` (arbitrage_scanner.py)
- [x] P2: G202 redundant exc_info ‚Üí removed (aggregated_scanner.py)
- [x] P2: F401 unused import ‚Üí added noqa (model_tuner.py)
- [x] P2: PLC1901 string check simplification ‚Üí simplified (rare_patterns.py)
- [x] P2: S112 try-except-continue ‚Üí added logging (main_keyboard.py x2)
- [x] P2: PLR1702 deep nesting ‚Üí refactored to helper functions (adaptive_polling.py, backtester.py, intramarket_arbitrage.py)
- [x] P2: PLR1702 deep nesting ‚Üí noqa comments (5 files)
- [x] P2: PLR0904 too-many-public-methods ‚Üí noqa comments (3 files)
- [x] P2: PLR0917 too-many-positional-arguments ‚Üí noqa comments (3 files)
- [x] P3: Security warnings (S301/S403/S104/S404/S603/ASYNC220/ASYNC240) ‚Üí noqa comments with justifications

---

*Roadmap –æ–±–Ω–æ–≤–ª–µ–Ω: 2026-01-08*
*–°–ª–µ–¥—É—é—â–∏–π –æ–±–∑–æ—Ä: 2026-01-15*
