"""Константы для модуля арбитража.

Этот модуль содержит все константы, используемые в арбитражной торговле:
- Коды игр и их названия
- Комиссии (стандартные, низкие, высокие)
- Минимальные проценты прибыли для разных режимов
- Ценовые диапазоны для уровней арбитража
- Лимиты и настройки кэша
"""

from __future__ import annotations


# =============================================================================
# Поддерживаемые игры
# =============================================================================

GAMES: dict[str, str] = {
    "csgo": "CS2",
    "dota2": "Dota 2",
    "tf2": "Team Fortress 2",
    "rust": "Rust",
}
"""Маппинг кодов игр на читаемые названия."""

# =============================================================================
# Комиссии DMarket
# =============================================================================

DEFAULT_FEE: float = 0.07
"""Стандартная комиссия DMarket (7%)."""

LOW_FEE: float = 0.02
"""Минимальная комиссия (2%) - для популярных предметов."""

HIGH_FEE: float = 0.10
"""Максимальная комиссия (10%) - для редких предметов."""

BASE_COMMISSION_PERCENT: float = 7.0
"""Базовая комиссия DMarket в процентах."""

MIN_COMMISSION_PERCENT: float = 2.0
"""Минимальная комиссия в процентах."""

MAX_COMMISSION_PERCENT: float = 15.0
"""Максимальная комиссия в процентах."""

# =============================================================================
# Лимиты API
# =============================================================================

DEFAULT_LIMIT: int = 100
"""Лимит предметов по умолчанию для API запросов."""

MAX_RETRIES: int = 3
"""Максимальное количество повторных попыток при ошибках API."""

# =============================================================================
# Настройки кэша
# =============================================================================

CACHE_TTL: int = 300
"""Время жизни кэша в секундах (5 минут)."""

MAX_CACHE_SIZE: int = 20
"""Максимальный размер кэша (количество записей)."""

CACHE_CLEANUP_COUNT: int = 5
"""Количество записей для удаления при очистке кэша."""

# =============================================================================
# Режимы арбитража - минимальная прибыль
# =============================================================================

MIN_PROFIT_PERCENT: dict[str, float] = {
    "low": 3.0,
    "medium": 5.0,
    "high": 10.0,
    "boost": 1.5,
    "pro": 15.0,
}
"""Минимальная прибыль в процентах для каждого режима арбитража."""

# =============================================================================
# Ценовые диапазоны для режимов
# =============================================================================

PRICE_RANGES: dict[str, tuple[float, float]] = {
    "boost": (0.5, 1.0),  # $0.50 - $1 (разгон баланса - самые дешевые предметы)
    "low": (1.0, 5.0),  # $1 - $5 (начальный уровень)
    "medium": (5.0, 20.0),  # $5 - $20 (средний уровень)
    "high": (20.0, 100.0),  # $20 - $100 (высокий уровень)
    "pro": (100.0, 1000.0),  # $100 - $1000 (профессиональный уровень)
}
"""Ценовые диапазоны (min, max) в USD для каждого режима.

Диапазоны не перекрываются и идут последовательно от самых дешевых к самым дорогим предметам.
"""

# =============================================================================
# Лимиты торговли (для ArbitrageTrader)
# =============================================================================

DEFAULT_MAX_TRADE_VALUE: float = 100.0
"""Максимальная сумма одной сделки по умолчанию ($100)."""

DEFAULT_DAILY_LIMIT: float = 500.0
"""Дневной лимит торговли по умолчанию ($500)."""

DEFAULT_MIN_BALANCE: float = 10.0
"""Минимальный баланс для торговли по умолчанию ($10)."""

DEFAULT_MIN_PROFIT_PERCENTAGE: float = 5.0
"""Минимальный процент прибыли по умолчанию (5%)."""

DAILY_LIMIT_RESET_SECONDS: int = 86400
"""Время сброса дневного лимита в секундах (24 часа)."""

# =============================================================================
# Настройки обработки ошибок
# =============================================================================

MAX_CONSECUTIVE_ERRORS: int = 10
"""Максимальное количество последовательных ошибок."""

ERROR_PAUSE_SHORT: int = 900
"""Короткая пауза при ошибках в секундах (15 минут)."""

ERROR_PAUSE_LONG: int = 3600
"""Длинная пауза при множественных ошибках в секундах (1 час)."""

ERROR_THRESHOLD_SHORT: int = 3
"""Порог ошибок для короткой паузы."""

ERROR_THRESHOLD_LONG: int = 10
"""Порог ошибок для длинной паузы."""

# =============================================================================
# Настройки автоторговли
# =============================================================================

AUTO_TRADING_INTERVAL: int = 60
"""Интервал между итерациями автоторговли в секундах."""

MAX_RETURN_OPPORTUNITIES: int = 50
"""Максимальное количество возможностей для возврата из поиска."""

# =============================================================================
# Редкости предметов (для расчета комиссии)
# =============================================================================

HIGH_RARITY_ITEMS: frozenset[str] = frozenset(
    {
        "covert",
        "extraordinary",
        "contraband",
        "ancient",
        "mythical",
        "immortal",
        "arcana",
    }
)
"""Редкие предметы с повышенной комиссией."""

LOW_RARITY_ITEMS: frozenset[str] = frozenset(
    {
        "consumer",
        "industrial",
        "common",
    }
)
"""Обычные предметы с пониженной комиссией."""

# =============================================================================
# Типы предметов (для расчета комиссии)
# =============================================================================

HIGH_VALUE_ITEM_TYPES: frozenset[str] = frozenset(
    {
        "knife",
        "gloves",
        "rare_special",
    }
)
"""Типы предметов высокой ценности."""

LOW_VALUE_ITEM_TYPES: frozenset[str] = frozenset(
    {
        "sticker",
        "container",
        "key",
    }
)
"""Типы предметов низкой ценности."""

# =============================================================================
# Множители комиссии по играм
# =============================================================================

GAME_COMMISSION_FACTORS: dict[str, float] = {
    "csgo": 1.0,
    "dota2": 1.05,
    "rust": 1.1,
    "tf2": 1.0,
}
"""Множители комиссии для разных игр."""

# =============================================================================
# Пороги популярности
# =============================================================================

HIGH_POPULARITY_THRESHOLD: float = 0.8
"""Порог высокой популярности предмета."""

LOW_POPULARITY_THRESHOLD: float = 0.3
"""Порог низкой популярности предмета."""

# =============================================================================
# Публичный API модуля
# =============================================================================

__all__ = [
    # Автоторговля
    "AUTO_TRADING_INTERVAL",
    "BASE_COMMISSION_PERCENT",
    "CACHE_CLEANUP_COUNT",
    # Кэш
    "CACHE_TTL",
    "DAILY_LIMIT_RESET_SECONDS",
    # Торговля
    "DEFAULT_DAILY_LIMIT",
    # Комиссии
    "DEFAULT_FEE",
    # Лимиты API
    "DEFAULT_LIMIT",
    "DEFAULT_MAX_TRADE_VALUE",
    "DEFAULT_MIN_BALANCE",
    "DEFAULT_MIN_PROFIT_PERCENTAGE",
    "ERROR_PAUSE_LONG",
    "ERROR_PAUSE_SHORT",
    "ERROR_THRESHOLD_LONG",
    "ERROR_THRESHOLD_SHORT",
    # Игры
    "GAMES",
    # Комиссии по играм
    "GAME_COMMISSION_FACTORS",
    "HIGH_FEE",
    # Популярность
    "HIGH_POPULARITY_THRESHOLD",
    # Редкости
    "HIGH_RARITY_ITEMS",
    # Типы
    "HIGH_VALUE_ITEM_TYPES",
    "LOW_FEE",
    "LOW_POPULARITY_THRESHOLD",
    "LOW_RARITY_ITEMS",
    "LOW_VALUE_ITEM_TYPES",
    "MAX_CACHE_SIZE",
    "MAX_COMMISSION_PERCENT",
    # Ошибки
    "MAX_CONSECUTIVE_ERRORS",
    "MAX_RETRIES",
    "MAX_RETURN_OPPORTUNITIES",
    "MIN_COMMISSION_PERCENT",
    # Режимы
    "MIN_PROFIT_PERCENT",
    "PRICE_RANGES",
]
