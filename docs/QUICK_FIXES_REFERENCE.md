# üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º –±–æ—Ç–∞

## ‚úÖ –í—Å–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!

**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 03.01.2026
**–í–µ—Ä—Å–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:** 4.0

---

## üìã –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫

| #   | –û—à–∏–±–∫–∞                                                             | –°—Ç–∞—Ç—É—Å       | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ |
| --- | ------------------------------------------------------------------ | ------------ | ---------- |
| 1   | `AttributeError: 'PicklePersistence' has no attribute 'StoreData'` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | 4          |
| 2   | `TypeError: cannot pickle 'module' object`                         | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | 3          |
| 3   | `'Application' object has no attribute 'db'`                       | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | 2          |
| 4   | `parsing field "Status": "active" is not a valid value`            | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | 2          |
| 5   | `HTTP/2 not available`                                             | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | 2          |
| 6   | `Input should be a valid string` (Pydantic)                        | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | 1          |

---

## üéØ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
python -m src.main

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å Steam-–∞—Ä–±–∏—Ç—Ä–∞–∂ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# –í Telegram:
/steam_arbitrage_start csgo 5
```

---

## üîç –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –û—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ –≤ handlers

**–°–∏–º–ø—Ç–æ–º:** `'Application' object has no attribute 'dmarket_api'`

**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏—Ç–µ handlers —Å–æ–≥–ª–∞—Å–Ω–æ `MIGRATION_GUIDE_BOT_DATA.md`

```python
# ‚ùå –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±
api = context.bot_data.get("dmarket_api")

# ‚úÖ –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–±
api = context.application.dmarket_api
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: HTTP/2 –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–°–∏–º–ø—Ç–æ–º:** `HTTP/2 not available` –≤ –ª–æ–≥–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:**
```bash
pip install httpx[http2]
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –û—à–∏–±–∫–∏ Pydantic —Å —Ü–µ–Ω–∞–º–∏

**–°–∏–º–ø—Ç–æ–º:** `Input should be a valid string`

**–†–µ—à–µ–Ω–∏–µ:** –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ `src/dmarket/models/market_models.py` –∏ `src/dmarket/schemas.py`

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –û—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –±–æ—Ç–∞

**–°–∏–º–ø—Ç–æ–º:** `TypeError: cannot pickle 'module' object`

**–†–µ—à–µ–Ω–∏–µ:** –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ - bot_data –∏—Å–∫–ª—é—á–µ–Ω –∏–∑ persistence

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –§–∞–π–ª                                    | –û–ø–∏—Å–∞–Ω–∏–µ                         |
| --------------------------------------- | -------------------------------- |
| `FIXES_APPLIED_FINAL.md`                | –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –æ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö |
| `MIGRATION_GUIDE_BOT_DATA.md`           | –ì–∞–π–¥ –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é handlers      |
| `FIXES_APPLIED_FINAL.md` (–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ 4) | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ PersistenceInput     |

---

## üîß –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. Persistence (python-telegram-bot v20+)
```python
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PersistenceInput –≤–º–µ—Å—Ç–æ PicklePersistence.StoreData
from telegram.ext import PersistenceInput

persistence = PicklePersistence(
    filepath="data/bot_persistence.pickle",
    store_data=PersistenceInput(
        bot_data=False,  # –ò—Å–∫–ª—é—á–µ–Ω–æ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è pickle errors
        chat_data=True,
        user_data=True,
        callback_data=True,
    )
)
```

### 2. –î–æ—Å—Ç—É–ø –∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º
```python
# –í—Å–µ –æ–±—ä–µ–∫—Ç—ã —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ –∞—Ç—Ä–∏–±—É—Ç—ã application
application.dmarket_api
application.database
application.db  # –î–ª—è AutopilotOrchestrator
application.scanner_manager
application.steam_arbitrage_scanner
```

### 3. DMarket API —Å—Ç–∞—Ç—É—Å—ã
```python
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è TargetStatusActive –≤–º–µ—Å—Ç–æ "active"
status="TargetStatusActive"
```

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
ruff check src/

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pytest tests/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
mypy src/

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
black src/

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
python -m src.main
```

---

## üéâ –°—Ç–∞—Ç—É—Å: –ë–û–¢ –†–ê–ë–û–¢–ê–ï–¢!

**‚úÖ Autopilot Orchestrator initialized successfully**

–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç! –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã.

**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ AutopilotOrchestrator
- ‚úÖ Scanner Manager
- ‚úÖ Steam Arbitrage Scanner
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è handlers)

**–û—Å—Ç–∞–ª–æ—Å—å –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
- ‚ö†Ô∏è –û—à–∏–±–∫–∞ 401 –¥–ª—è User Targets (—Å–º. `FIX_401_UNAUTHORIZED.md`)

---

## üõ† –§–∏–Ω–∞–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ 5)

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–§–∞–π–ª:** `src/telegram_bot/notifications/handlers.py`

**–ò–∑–º–µ–Ω–µ–Ω–æ:**
```python
# ‚ùå –ë–´–õ–û:
api = application.bot_data.get("dmarket_api")

# ‚úÖ –°–¢–ê–õ–û:
api = getattr(application, "dmarket_api", None)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–µ–ø–µ—Ä—å –≤–∏–¥—è—Ç DMarket API ‚úÖ

---

## üìã –†–µ—à–µ–Ω–∏–µ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –ø—Ä–æ–±–ª–µ–º

### 1. –û—à–∏–±–∫–∞ 401 Unauthorized (User Targets)

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ —É API –∫–ª—é—á–∞
2. –ù–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è Windows
3. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –≤ –∑–∞–ø—Ä–æ—Å–µ

**–†–µ—à–µ–Ω–∏–µ:** –°–º. `FIX_401_UNAUTHORIZED.md`

**–ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è: Win + I ‚Üí –í—Ä–µ–º—è –∏ —è–∑—ã–∫ ‚Üí –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –ø—Ä–∞–≤–∞ –≤ DMarket: View Targets + Manage Targets
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Steam-–∞—Ä–±–∏—Ç—Ä–∞–∂
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ (–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫)
4. –ù–∞—Å–ª–∞–∂–¥–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ç–æ—Ä–≥–æ–≤–ª–µ–π! üöÄ
