# Инструкция по запуску DMarket Telegram Bot

## Предварительные требования

1. Python 3.9 или выше
2. Установленные зависимости из `requirements.txt`
3. Telegram Bot Token
4. DMarket API ключи (опционально, для полной функциональности)

## Шаг 1: Установка зависимостей

```bash
pip install -r requirements.txt
```

## Шаг 2: Настройка переменных окружения

Создайте файл `.env` в корне проекта со следующим содержимым:

```env
# Обязательные параметры
TELEGRAM_BOT_TOKEN=ваш_telegram_bot_token

# DMarket API (опционально, но рекомендуется)
DMARKET_PUBLIC_KEY=ваш_dmarket_public_key
DMARKET_SECRET_KEY=ваш_dmarket_secret_key
DMARKET_API_URL=https://api.dmarket.com

# Дополнительные настройки
LOG_LEVEL=INFO
DATABASE_URL=sqlite:///data/dmarket_bot.db
DEBUG=false
TESTING=false
```

### Как получить токены:

#### Telegram Bot Token:
1. Откройте Telegram и найдите @BotFather
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Скопируйте полученный токен

#### DMarket API ключи:
1. Зарегистрируйтесь на https://dmarket.com
2. Перейдите в настройки API
3. Создайте новую пару ключей (Public Key и Secret Key)

## Шаг 3: Создание необходимых директорий

```bash
mkdir -p data logs
```

## Шаг 4: Запуск бота

### Вариант 1: Через основной модуль (рекомендуется)

```bash
python -m src.main
```

или

```bash
python src/main.py
```

### Вариант 2: Через скрипт запуска

```bash
python scripts/run_bot.py
```

### Дополнительные опции запуска:

#### Режим отладки:
```bash
python -m src.main --debug
```

или

```bash
python -m src.main --log-level DEBUG
```

#### С пользовательским конфигом:
```bash
python -m src.main --config config/local.yaml
```

## Проверка работы бота

После запуска вы должны увидеть в логах:

```
INFO - Configuration loaded successfully
INFO - Database initialized successfully
INFO - DMarket API connected. Balance: $XXX.XX
INFO - Telegram Bot initialized successfully
INFO - Starting DMarket Telegram Bot...
INFO - Polling mode started
INFO - Bot is running. Press Ctrl+C to stop.
```

Теперь откройте Telegram и найдите вашего бота по имени пользователя. Отправьте команду `/start` для проверки.

## Основные команды бота

- `/start` - Начать работу с ботом
- `/help` - Показать список доступных команд
- `/arbitrage` - Меню арбитража
- `/balance` - Проверить баланс DMarket (требуются API ключи)
- `/markets` - Сравнение рынков
- `/webapp` - Открыть DMarket в WebApp

## Режим тестирования

Если вы хотите запустить бота без DMarket API ключей для тестирования:

```bash
export TESTING=true
python -m src.main
```

или добавьте в `.env`:
```
TESTING=true
```

## Остановка бота

Нажмите `Ctrl+C` в терминале для корректной остановки бота.

## Решение проблем

### Бот не запускается

1. **Ошибка "TELEGRAM_BOT_TOKEN is required"**
   - Убедитесь, что `.env` файл создан и содержит токен
   - Проверьте, что токен правильный и актуальный

2. **Ошибка "Failed to initialize application"**
   - Проверьте логи в `logs/dmarket_bot.log`
   - Убедитесь, что все зависимости установлены

3. **Ошибка подключения к DMarket API**
   - Проверьте правильность API ключей
   - Убедитесь, что ключи не истекли
   - Попробуйте режим тестирования: `TESTING=true`

4. **Ошибка базы данных**
   - Убедитесь, что директория `data/` существует
   - Проверьте права доступа к директории

### Логи

- Основные логи: `logs/dmarket_bot.log`
- Логи сервиса: `logs/bot_service.log`

Уровни логирования можно изменить через переменную `LOG_LEVEL`:
- `DEBUG` - подробные логи (для отладки)
- `INFO` - стандартные логи (по умолчанию)
- `WARNING` - только предупреждения и ошибки
- `ERROR` - только ошибки

## Docker (опционально)

Если вы хотите запустить бота в Docker:

```bash
docker-compose up -d
```

Для просмотра логов:
```bash
docker-compose logs -f
```

Для остановки:
```bash
docker-compose down
```

## Дополнительная информация

- [Документация API](docs/api_reference.md)
- [Архитектура проекта](docs/ARCHITECTURE.md)
- [Руководство по разработке](docs/CONTRIBUTING.md)
- [Быстрый старт](docs/QUICK_START.md)

