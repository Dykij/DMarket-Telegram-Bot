# –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è 236 —É–ø–∞–≤—à–∏—Ö —Ç–µ—Å—Ç–æ–≤

**–î–∞—Ç–∞**: 25 –Ω–æ—è–±—Ä—è 2025 –≥.
**–û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞**: –î–µ–∫–æ—Ä–∞—Ç–æ—Ä `@handle_exceptions` —Å `reraise=True` –≤ telegram bot handlers

---

## üîç –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: –í—Å–µ telegram bot handlers –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@handle_exceptions` —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `reraise=True`. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç —á—Ç–æ –ª—é–±–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ **–≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞—Ä—É–∂—É**, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–∞–¥–µ–Ω–∏—é —Ç–µ—Å—Ç–æ–≤.

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**: Telegram bot handlers **–ù–ï –¥–æ–ª–∂–Ω—ã** –≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è. –û–Ω–∏ –¥–æ–ª–∂–Ω—ã:
1. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É
2. –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
3. –í–æ–∑–≤—Ä–∞—â–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑ exception

**–¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**:
```python
@handle_exceptions(
    logger_instance=logger,
    default_error_message="–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–æ–º–∞–Ω–¥—ã /alerts",
)  # reraise=True –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - –≠–¢–û –ë–ê–ì!
async def alerts_command(...):
    ...
```

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**:
```python
@handle_exceptions(
    logger_instance=logger,
    default_error_message="–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–æ–º–∞–Ω–¥—ã /alerts",
    reraise=False,  # –ù–ï –≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞—Ä—É–∂—É
)
async def alerts_command(...):
    ...
```

---

## üìã –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)

### –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: –í–´–°–û–ö–ê–Ø (–±–ª–æ–∫–∏—Ä—É–µ—Ç 173 —Ç–µ—Å—Ç–∞)

1. `src/telegram_bot/handlers/market_alerts_handler.py`
   - `alerts_command` - –¥–æ–±–∞–≤–∏—Ç—å `reraise=False`
   - `alerts_callback` - –¥–æ–±–∞–≤–∏—Ç—å `reraise=False`
   - **–ó–∞—Ç—Ä–æ–Ω—É—Ç–æ**: 27 —Ç–µ—Å—Ç–æ–≤

2. `src/telegram_bot/handlers/dmarket_status.py`
   - `handle_dmarket_status_command` - –¥–æ–±–∞–≤–∏—Ç—å `reraise=False`
   - **–ó–∞—Ç—Ä–æ–Ω—É—Ç–æ**: 6 —Ç–µ—Å—Ç–æ–≤

3. `src/telegram_bot/handlers/scanner_handler.py`
   - `handle_level_scan` - –¥–æ–±–∞–≤–∏—Ç—å `reraise=False`
   - `handle_market_overview` - –¥–æ–±–∞–≤–∏—Ç—å `reraise=False`
   - **–ó–∞—Ç—Ä–æ–Ω—É—Ç–æ**: 2 —Ç–µ—Å—Ç–∞

4. `src/telegram_bot/handlers/target_handler.py`
   - `handle_target_callback` - –¥–æ–±–∞–≤–∏—Ç—å `reraise=False`
   - **–ó–∞—Ç—Ä–æ–Ω—É—Ç–æ**: 1 —Ç–µ—Å—Ç

5. `src/telegram_bot/handlers/intramarket_arbitrage_handler.py`
   - `start_intramarket_arbitrage` - –¥–æ–±–∞–≤–∏—Ç—å `reraise=False`
   - `handle_intramarket_callback` - –¥–æ–±–∞–≤–∏—Ç—å `reraise=False`
   - **–ó–∞—Ç—Ä–æ–Ω—É—Ç–æ**: 7 —Ç–µ—Å—Ç–æ–≤

6. `src/telegram_bot/handlers/sales_analysis_handlers.py`
   - –í—Å–µ handlers - –¥–æ–±–∞–≤–∏—Ç—å `reraise=False`
   - **–ó–∞—Ç—Ä–æ–Ω—É—Ç–æ**: 11 —Ç–µ—Å—Ç–æ–≤

7. `src/telegram_bot/handlers/arbitrage_callback_impl.py`
   - –í—Å–µ callback handlers - –¥–æ–±–∞–≤–∏—Ç—å `reraise=False`
   - **–ó–∞—Ç—Ä–æ–Ω—É—Ç–æ**: 5 —Ç–µ—Å—Ç–æ–≤

8. `src/telegram_bot/test_notifier.py` (–≤–æ–∑–º–æ–∂–Ω–æ –¥—Ä—É–≥–∞—è –ø—Ä–æ–±–ª–µ–º–∞)
   - **–ó–∞—Ç—Ä–æ–Ω—É—Ç–æ**: 42 —Ç–µ—Å—Ç–∞

9. `src/telegram_bot/test_price_alerts_handler.py`
   - **–ó–∞—Ç—Ä–æ–Ω—É—Ç–æ**: 34 —Ç–µ—Å—Ç–∞

10. `src/telegram_bot/test_game_filter_handlers.py`
    - **–ó–∞—Ç—Ä–æ–Ω—É—Ç–æ**: 56 —Ç–µ—Å—Ç–æ–≤

---

## üéØ –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –§–∞–∑–∞ 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å handlers (–æ—Ü–µ–Ω–∫–∞: 30 –º–∏–Ω—É—Ç)

1. **–ù–∞–π—Ç–∏ –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `@handle_exceptions` –≤ telegram_bot/handlers/**
2. **–î–æ–±–∞–≤–∏—Ç—å `reraise=False`** –∫ –∫–∞–∂–¥–æ–º—É –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—É
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ handlers –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –§–∞–∑–∞ 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã (–æ—Ü–µ–Ω–∫–∞: 5 –º–∏–Ω—É—Ç)

```bash
pytest tests/telegram_bot/handlers/ -v --tb=short
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: **–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–π—Ç–∏**

### –§–∞–∑–∞ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –ø—Ä–æ–±–ª–µ–º—ã (–æ—Ü–µ–Ω–∫–∞: 1-2 —á–∞—Å–∞)

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ—Å—Ç—ã notifier, price_alerts_handler, game_filter_handlers
- –í–æ–∑–º–æ–∂–Ω–æ —Ç–∞–º –¥—Ä—É–≥–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å reraise)

---

## üîß –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å grep + sed –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```bash
# –ù–∞–π—Ç–∏ –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è @handle_exceptions –±–µ–∑ reraise=False
grep -r "@handle_exceptions" src/telegram_bot/handlers/ -A 3

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ reraise=False (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
# –í–ù–ò–ú–ê–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º!
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

**–£—Å–ø–µ—Ö**: –í—Å–µ 173 —Ç–µ—Å—Ç–∞ telegram_bot/handlers/ –ø—Ä–æ—Ö–æ–¥—è—Ç
**–ú–µ—Ç—Ä–∏–∫–∞**: `pytest tests/telegram_bot/handlers/ -v` ‚Üí 0 failed

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 236 failed tests
**–ü–æ—Å–ª–µ –§–∞–∑—ã 1**: ~60-80 failed tests (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã handlers)
**–ü–æ—Å–ª–µ –§–∞–∑—ã 2-3**: 0-20 failed tests (edge cases –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã)

---

## üöÄ –ù–∞—á–∏–Ω–∞–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π—Ç–∏ –≤—Å–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –∏ –¥–æ–±–∞–≤–∏—Ç—å `reraise=False`
