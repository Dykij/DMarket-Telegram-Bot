# ‚ö†Ô∏è –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã 401 Unauthorized –¥–ª—è User Targets

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞

**–û—à–∏–±–∫–∞ –≤ –ª–æ–≥–∞—Ö:**
```
HTTP –æ—à–∏–±–∫–∞ 401: ... /user-targets
{"error":"Unauthorized"}
```

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ë–∞–ª–∞–Ω—Å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è ‚úÖ ($45.50 USD)
- –ù–æ —Ç–∞—Ä–≥–µ—Ç—ã (buy orders) –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è ‚ùå (401 Unauthorized)

---

## ‚úÖ –†–µ—à–µ–Ω–∏—è (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ 3 –ø—É–Ω–∫—Ç–∞)

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ API –∫–ª—é—á–∞

**–ì–¥–µ:** https://dmarket.com/account/api-keys

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- ‚úÖ –ì–∞–ª–æ—á–∫–∞ –Ω–∞ **"View Targets"** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- ‚úÖ –ì–∞–ª–æ—á–∫–∞ –Ω–∞ **"Manage Targets"** (–µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å)
- ‚úÖ –ì–∞–ª–æ—á–∫–∞ –Ω–∞ **"View Balance"** (—É–∂–µ –µ—Å—Ç—å, —Ç.–∫. –±–∞–ª–∞–Ω—Å —Ä–∞–±–æ—Ç–∞–µ—Ç)

**–ï—Å–ª–∏ –≥–∞–ª–æ—á–µ–∫ –Ω–µ—Ç:**
1. –ó–∞–π—Ç–∏ –≤ DMarket ‚Üí Settings ‚Üí API Keys
2. –£–¥–∞–ª–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∫–ª—é—á
3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å –Ω—É–∂–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
4. –û–±–Ω–æ–≤–∏—Ç—å `.env` —Ñ–∞–π–ª —Å –Ω–æ–≤—ã–º–∏ –∫–ª—é—á–∞–º–∏

---

### 2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è Windows

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:** DMarket –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Ä–µ–º—è –≤ HMAC –ø–æ–¥–ø–∏—Å–∏. –†–∞–∑–Ω–∏—Ü–∞ –¥–∞–∂–µ –≤ 3-5 —Å–µ–∫—É–Ω–¥ –≤—ã–∑—ã–≤–∞–µ—Ç 401.

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**

**–°–ø–æ—Å–æ–± 1 (–±—ã—Å—Ç—Ä—ã–π):**
1. Win + I ‚Üí –í—Ä–µ–º—è –∏ —è–∑—ã–∫ ‚Üí –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
2. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É **"–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å"**
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

**–°–ø–æ—Å–æ–± 2 (PowerShell):**
```powershell
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–ª—É–∂–±—É –≤—Ä–µ–º–µ–Ω–∏
Stop-Service w32time

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
w32tm /resync

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–ª—É–∂–±—É –≤—Ä–µ–º–µ–Ω–∏
Start-Service w32time
```

**–°–ø–æ—Å–æ–± 3 (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–Ω–∏—Ü—ã):**
```powershell
# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –∏ NTP-—Å–µ—Ä–≤–µ—Ä
w32tm /query /status
```

---

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –ª–∏ —Å—Ç–∞—Ç—É—Å "active"

**–§–∞–π–ª:** `src/dmarket/target_cleaner.py`

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä–æ–∫—É ~81:**
```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –û–±–Ω–æ–≤–ª–µ–Ω–∏–∏ 2)
response = await self.api_client.get_user_targets(
    game_id=game, status="TargetStatusActive"
)

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (–≤—ã–∑—ã–≤–∞–µ—Ç 400 Bad Request)
response = await self.api_client.get_user_targets(
    game_id=game, status="active"
)
```

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –æ—Å—Ç–∞–ª–∞—Å—å:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
grep -n "TargetStatusActive" src/dmarket/target_cleaner.py

# –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
sed -i 's/status="active"/status="TargetStatusActive"/g' src/dmarket/target_cleaner.py
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:**
   ```bash
   python -m src.main
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**
   ```
   # ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   INFO - –¢–∞—Ä–≥–µ—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω—ã: 0 –∞–∫—Ç–∏–≤–Ω—ã—Ö

   # ‚ùå –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   HTTP –æ—à–∏–±–∫–∞ 401
   ```

3. **–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –æ—Å—Ç–∞–ª–∞—Å—å:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è: `w32tm /query /status`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –∫–ª—é—á –≤ DMarket
   - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π API –∫–ª—é—á —Å –ø–æ–ª–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏

---

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ HMAC –ø–æ–¥–ø–∏—Å–∏

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é HMAC –ø–æ–¥–ø–∏—Å–∏:

**–§–∞–π–ª:** `src/dmarket/dmarket_api.py`

**–ú–µ—Ç–æ–¥:** `_generate_signature()`

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```python
# –í—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å Unix timestamp –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
timestamp = str(int(time.time()))

# –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: timestamp = str(int(time.time() * 1000))
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

–í–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

```python
# –í dmarket_api.py –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º:
logger.debug(
    f"Request: {method} {url}",
    extra={
        "headers": headers,
        "timestamp": timestamp,
    }
)
```

---

## üìã Checklist –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

- [ ] –ü—Ä–∞–≤–∞ API –∫–ª—é—á–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã (View Targets + Manage Targets)
- [ ] –í—Ä–µ–º—è Windows —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
- [ ] `TargetStatusActive` –≤–º–µ—Å—Ç–æ `"active"` –≤ target_cleaner.py
- [ ] –ë–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- [ ] –û—à–∏–±–∫–∞ 401 –∏—Å—á–µ–∑–ª–∞ –∏–∑ –ª–æ–≥–æ–≤

---

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:

```
INFO - –ë–∞–ª–∞–Ω—Å: $45.50 ‚úÖ
INFO - –¢–∞—Ä–≥–µ—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã: 0 –∞–∫—Ç–∏–≤–Ω—ã—Ö ‚úÖ
INFO - Scanner Manager –∑–∞–ø—É—â–µ–Ω ‚úÖ
INFO - Auto Steam Arbitrage Scanner –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω ‚úÖ
INFO - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π –∑–∞–ø—É—â–µ–Ω–∞ ‚úÖ
```

**–ù–∏–∫–∞–∫–∏—Ö –æ—à–∏–±–æ–∫ 401!** ‚úÖ

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 03.01.2026
**–°–≤—è–∑–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2, 3, 4
