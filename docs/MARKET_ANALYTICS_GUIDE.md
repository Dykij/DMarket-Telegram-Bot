# üìä Market Analytics Guide

**–í–µ—Ä—Å–∏—è**: 1.0
**–î–∞—Ç–∞**: 23 –Ω–æ—è–±—Ä—è 2025 –≥.

---

## üìã –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤ –∏ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —Ü–µ–Ω –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏ –Ω–∞ DMarket.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã** - RSI, MACD, Bollinger Bands
- ‚úÖ **–†–∞—Å—á–µ—Ç —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–π —Ü–µ–Ω—ã** - –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤** - –≤–æ—Å—Ö–æ–¥—è—â–∏–π, –Ω–∏—Å—Ö–æ–¥—è—â–∏–π, –±–æ–∫–æ–≤–æ–π
- ‚úÖ **–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –ø–∞–¥–µ–Ω–∏—è —Ü–µ–Ω** - –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
- ‚úÖ **–ê–Ω–∞–ª–∏–∑ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏** - –æ—Ü–µ–Ω–∫–∞ —Ç–æ—Ä–≥–æ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- ‚úÖ **–£—Ä–æ–≤–Ω–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è** - –∫–ª—é—á–µ–≤—ã–µ —Ü–µ–Ω–æ–≤—ã–µ —É—Ä–æ–≤–Ω–∏
- ‚úÖ **–¢–æ—Ä–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏** - –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ insights

---

## üéØ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

### RSI (Relative Strength Index)

**–ò–Ω–¥–µ–∫—Å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏–ª—ã** - –∏–∑–º–µ—Ä—è–µ—Ç –∏–º–ø—É–ª—å—Å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω.

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**
- RSI > 70 ‚Üí **–ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–æ** (–≤–µ—Ä–æ—è—Ç–Ω–æ –ø–∞–¥–µ–Ω–∏–µ)
- RSI < 30 ‚Üí **–ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–æ** (–≤–µ—Ä–æ—è—Ç–Ω–æ —Ä–æ—Å—Ç)
- RSI ‚âà 50 ‚Üí **–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ**

```python
from src.utils.market_analytics import TechnicalIndicators

prices = [10.5, 11.2, 10.8, 11.5, 12.0, 11.8, 12.5]

rsi_value = TechnicalIndicators.rsi(prices, period=14)

if rsi_value:
    if rsi_value > 70:
        print("‚ö†Ô∏è –ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–æ - –≤–æ–∑–º–æ–∂–Ω–æ –ø–∞–¥–µ–Ω–∏–µ —Ü–µ–Ω—ã")
    elif rsi_value < 30:
        print("‚úÖ –ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–æ - —Ö–æ—Ä–æ—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –ø–æ–∫—É–ø–∫–∏")
    else:
        print("‚ûñ –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ")
```

### MACD (Moving Average Convergence Divergence)

**–°—Ö–æ–∂–¥–µ–Ω–∏–µ-—Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ —Å–∫–æ–ª—å–∑—è—â–∏—Ö —Å—Ä–µ–¥–Ω–∏—Ö** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∑–∞–∏–º–æ—Å–≤—è–∑—å –º–µ–∂–¥—É –¥–≤—É–º—è —Å–∫–æ–ª—å–∑—è—â–∏–º–∏ —Å—Ä–µ–¥–Ω–∏–º–∏.

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**
- MACD > Signal ‚Üí **–ë—ã—á–∏–π —Ç—Ä–µ–Ω–¥** (–ø–æ–∫—É–ø–∫–∞)
- MACD < Signal ‚Üí **–ú–µ–¥–≤–µ–∂–∏–π —Ç—Ä–µ–Ω–¥** (–ø—Ä–æ–¥–∞–∂–∞)
- Histogram > 0 ‚Üí **–£—Å–∏–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞**

```python
macd_data = TechnicalIndicators.macd(
    prices,
    fast_period=12,
    slow_period=26,
    signal_period=9
)

if macd_data:
    if macd_data["macd"] > macd_data["signal"]:
        print("üìà –ë—ã—á–∏–π —Å–∏–≥–Ω–∞–ª - —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–∫—É–ø–∫—É")
    else:
        print("üìâ –ú–µ–¥–≤–µ–∂–∏–π —Å–∏–≥–Ω–∞–ª - —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–¥–∞–∂—É")

    print(f"MACD: {macd_data['macd']:.2f}")
    print(f"Signal: {macd_data['signal']:.2f}")
    print(f"Histogram: {macd_data['histogram']:.2f}")
```

### Bollinger Bands

**–ü–æ–ª–æ—Å—ã –ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä–∞** - –∏–∑–º–µ—Ä—è—é—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Ä—ã–Ω–∫–∞.

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**
- –¶–µ–Ω–∞ —É –≤–µ—Ä—Ö–Ω–µ–π –ø–æ–ª–æ—Å—ã ‚Üí **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–æ**
- –¶–µ–Ω–∞ —É –Ω–∏–∂–Ω–µ–π –ø–æ–ª–æ—Å—ã ‚Üí **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–æ**
- –£–∑–∫–∏–µ –ø–æ–ª–æ—Å—ã ‚Üí **–ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å** (–≤–æ–∑–º–æ–∂–µ–Ω –ø—Ä–æ—Ä—ã–≤)

```python
bb = TechnicalIndicators.bollinger_bands(prices, period=20, std_dev=2.0)

if bb:
    current_price = prices[-1]

    print(f"Upper Band: ${bb['upper']:.2f}")
    print(f"Middle Band: ${bb['middle']:.2f}")
    print(f"Lower Band: ${bb['lower']:.2f}")

    if current_price > bb['upper']:
        print("‚ö†Ô∏è –¶–µ–Ω–∞ –≤—ã—à–µ –≤–µ—Ä—Ö–Ω–µ–π –ø–æ–ª–æ—Å—ã - –≤–æ–∑–º–æ–∂–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ü–∏—è")
    elif current_price < bb['lower']:
        print("‚úÖ –¶–µ–Ω–∞ –Ω–∏–∂–µ –Ω–∏–∂–Ω–µ–π –ø–æ–ª–æ—Å—ã - –≤–æ–∑–º–æ–∂–µ–Ω –æ—Ç—Å–∫–æ–∫")
```

---

## üí∞ –†–∞—Å—á–µ—Ç —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–π —Ü–µ–Ω—ã

### –ú–µ—Ç–æ–¥—ã —Ä–∞—Å—á–µ—Ç–∞

#### 1. –°—Ä–µ–¥–Ω–µ–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ (Mean)

```python
from src.utils.market_analytics import MarketAnalyzer, PricePoint
from datetime import datetime, UTC

analyzer = MarketAnalyzer(min_data_points=30)

price_history = [
    PricePoint(datetime.now(UTC), 10.5),
    PricePoint(datetime.now(UTC), 11.0),
    PricePoint(datetime.now(UTC), 10.8),
    # ... –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö
]

fair_price = analyzer.calculate_fair_price(
    price_history,
    method="mean"
)

print(f"–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–∞—è —Ü–µ–Ω–∞ (—Å—Ä–µ–¥–Ω–µ–µ): ${fair_price:.2f}")
```

#### 2. –ú–µ–¥–∏–∞–Ω–∞ (Median)

–£—Å—Ç–æ–π—á–∏–≤–∞ –∫ –≤—ã–±—Ä–æ—Å–∞–º:

```python
fair_price = analyzer.calculate_fair_price(
    price_history,
    method="median"
)

print(f"–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–∞—è —Ü–µ–Ω–∞ (–º–µ–¥–∏–∞–Ω–∞): ${fair_price:.2f}")
```

#### 3. Volume-Weighted (VWAP)

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** - —É—á–∏—Ç—ã–≤–∞–µ—Ç –æ–±—ä–µ–º—ã —Ç–æ—Ä–≥–æ–≤:

```python
price_history_with_volume = [
    PricePoint(datetime.now(UTC), 10.5, volume=100),
    PricePoint(datetime.now(UTC), 11.0, volume=150),
    PricePoint(datetime.now(UTC), 10.8, volume=80),
    # ... –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö
]

fair_price = analyzer.calculate_fair_price(
    price_history_with_volume,
    method="volume_weighted"
)

print(f"–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–∞—è —Ü–µ–Ω–∞ (VWAP): ${fair_price:.2f}")
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ç–æ—Ä–≥–æ–≤–ª–µ

```python
current_price = 12.50
fair_price = analyzer.calculate_fair_price(price_history)

deviation = ((current_price - fair_price) / fair_price) * 100

if deviation > 5:
    print(f"‚ùå –ü–µ—Ä–µ–æ—Ü–µ–Ω–µ–Ω –Ω–∞ {deviation:.1f}% - –ù–ï –ø–æ–∫—É–ø–∞—Ç—å")
elif deviation < -5:
    print(f"‚úÖ –ù–µ–¥–æ–æ—Ü–µ–Ω–µ–Ω –Ω–∞ {abs(deviation):.1f}% - —Ö–æ—Ä–æ—à–∞—è –ø–æ–∫—É–ø–∫–∞")
else:
    print(f"‚ûñ –¶–µ–Ω–∞ –±–ª–∏–∑–∫–∞ –∫ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–π ({deviation:.1f}%)")
```

---

## üìà –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤

### –ê–ª–≥–æ—Ä–∏—Ç–º

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—É—é –∏ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—É—é —Å–∫–æ–ª—å–∑—è—â–∏–µ —Å—Ä–µ–¥–Ω–∏–µ:

```python
trend = analyzer.detect_trend(
    price_history,
    short_period=7,   # 7 –¥–Ω–µ–π
    long_period=30    # 30 –¥–Ω–µ–π
)

print(f"–¢—Ä–µ–Ω–¥: {trend}")  # BULLISH, BEARISH, –∏–ª–∏ NEUTRAL
```

### –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è

```python
from src.utils.market_analytics import TrendDirection

if trend == TrendDirection.BULLISH:
    print("üìà –í–æ—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥ - —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–∫—É–ø–∫—É")
elif trend == TrendDirection.BEARISH:
    print("üìâ –ù–∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥ - –∏–∑–±–µ–≥–∞—Ç—å –ø–æ–∫—É–ø–∫–∏")
else:
    print("‚ûñ –ë–æ–∫–æ–≤–æ–π —Ç—Ä–µ–Ω–¥ - –∂–¥–∞—Ç—å —Å–∏–≥–Ω–∞–ª–∞")
```

---

## üîÆ –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –ø–∞–¥–µ–Ω–∏—è —Ü–µ–Ω

### –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç RSI, MACD, —Ç—Ä–µ–Ω–¥ –∏ Bollinger Bands:

```python
prediction = analyzer.predict_price_drop(
    price_history,
    threshold=0.65  # –ü–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ 65%
)

print(f"–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –ø–∞–¥–µ–Ω–∏—è: {prediction['prediction']}")
print(f"–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {prediction['confidence']:.1%}")
print(f"–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: {prediction['recommendation']}")

# –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã
for indicator, data in prediction['signals'].items():
    print(f"{indicator}: {data['signal']} (–≤–µ—Å: {data['weight']})")
```

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –±–æ—Ç–µ

```python
async def check_price_before_buy(item_id: str, price: float):
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑ —Ü–µ–Ω—ã –ø–µ—Ä–µ–¥ –ø–æ–∫—É–ø–∫–æ–π."""

    # –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
    price_history = await db.get_price_history(item_id, days=30)

    # –ê–Ω–∞–ª–∏–∑
    prediction = analyzer.predict_price_drop(price_history)

    if prediction['prediction'] and prediction['confidence'] > 0.7:
        # –í—ã—Å–æ–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–∞–¥–µ–Ω–∏—è —Ü–µ–Ω—ã
        logger.warning(
            "Price likely to drop",
            item_id=item_id,
            confidence=prediction['confidence']
        )

        await notifier.send_notification(
            user_id=user.telegram_id,
            message=f"‚ö†Ô∏è –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –ø–∞–¥–µ–Ω–∏—è —Ü–µ–Ω—ã!\n"
                    f"–ü—Ä–µ–¥–º–µ—Ç: {item_id}\n"
                    f"–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {prediction['confidence']:.1%}\n"
                    f"–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: {prediction['recommendation']}",
            priority="HIGH"
        )

        return False  # –ù–ï –ø–æ–∫—É–ø–∞—Ç—å

    return True  # –ú–æ–∂–Ω–æ –ø–æ–∫—É–ø–∞—Ç—å
```

---

## üéØ –£—Ä–æ–≤–Ω–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è

### –†–∞—Å—á–µ—Ç

```python
levels = analyzer.calculate_support_resistance(
    price_history,
    window=5  # –û–∫–Ω–æ –¥–ª—è –ø–æ–∏—Å–∫–∞ —ç–∫—Å—Ç—Ä–µ–º—É–º–æ–≤
)

print("–£—Ä–æ–≤–Ω–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏:")
for support in levels['support']:
    print(f"  ${support:.2f}")

print("\n–£—Ä–æ–≤–Ω–∏ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è:")
for resistance in levels['resistance']:
    print(f"  ${resistance:.2f}")
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ç–æ—Ä–≥–æ–≤–ª–µ

```python
current_price = 12.50
support_levels = levels['support']
resistance_levels = levels['resistance']

# –ù–∞–π—Ç–∏ –±–ª–∏–∂–∞–π—à—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É
nearest_support = max([s for s in support_levels if s < current_price], default=0)

# –ù–∞–π—Ç–∏ –±–ª–∏–∂–∞–π—à–µ–µ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ
nearest_resistance = min([r for r in resistance_levels if r > current_price], default=float('inf'))

print(f"–ë–ª–∏–∂–∞–π—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞: ${nearest_support:.2f}")
print(f"–ë–ª–∏–∂–∞–π—à–µ–µ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ: ${nearest_resistance:.2f}")

# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
distance_to_support = ((current_price - nearest_support) / current_price) * 100
distance_to_resistance = ((nearest_resistance - current_price) / current_price) * 100

if distance_to_support < 3:
    print("‚úÖ –ë–ª–∏–∑–∫–æ –∫ –ø–æ–¥–¥–µ—Ä–∂–∫–µ - —Ö–æ—Ä–æ—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –ø–æ–∫—É–ø–∫–∏")
elif distance_to_resistance < 3:
    print("‚ö†Ô∏è –ë–ª–∏–∑–∫–æ –∫ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—é - —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–¥–∞–∂—É")
```

---

## üíß –ê–Ω–∞–ª–∏–∑ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏

### –ú–µ—Ç—Ä–∏–∫–∏

```python
liquidity = analyzer.analyze_liquidity(
    price_history,
    recent_period=7  # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
)

print(f"–û—Ü–µ–Ω–∫–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏: {liquidity['score']:.2f}")
print(f"–°—Ä–µ–¥–Ω–∏–π –¥–Ω–µ–≤–Ω–æ–π –æ–±—ä–µ–º: {liquidity['avg_daily_volume']}")
print(f"–¢—Ä–µ–Ω–¥ –æ–±—ä–µ–º–∞: {liquidity['volume_trend']}")
print(f"–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –æ–±—ä–µ–º–∞: {liquidity['volume_consistency']:.2%}")
```

### –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è

```python
if liquidity['score'] > 0.7:
    print("‚úÖ –í—ã—Å–æ–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å - –ª–µ–≥–∫–æ –∫—É–ø–∏—Ç—å/–ø—Ä–æ–¥–∞—Ç—å")
elif liquidity['score'] > 0.4:
    print("‚ûñ –°—Ä–µ–¥–Ω—è—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å")
else:
    print("‚ùå –ù–∏–∑–∫–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å - –≤–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–¥–∞–∂–µ–π")
```

---

## üß† –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã–µ insights

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

```python
insights = analyzer.generate_trading_insights(
    price_history,
    current_price=12.50
)

# –û–±—â–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
print(f"–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: {insights['overall']['recommendation']}")
print(f"–û—Ü–µ–Ω–∫–∞: {insights['overall']['score']}")

# –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–∞—è —Ü–µ–Ω–∞
if 'fair_price' in insights:
    fp = insights['fair_price']
    print(f"\n–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–∞—è —Ü–µ–Ω–∞: ${fp['value']:.2f}")
    print(f"–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: {fp['deviation_percent']:.1f}%")
    print(f"–ü–µ—Ä–µ–æ—Ü–µ–Ω–µ–Ω: {fp['is_overpriced']}")
    print(f"–ù–µ–¥–æ–æ—Ü–µ–Ω–µ–Ω: {fp['is_underpriced']}")

# –¢—Ä–µ–Ω–¥
print(f"\n–¢—Ä–µ–Ω–¥: {insights['trend']['direction']}")

# –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
pred = insights['price_prediction']
print(f"\n–ü—Ä–æ–≥–Ω–æ–∑ –ø–∞–¥–µ–Ω–∏—è: {pred['prediction']}")
print(f"–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {pred['confidence']:.1%}")

# –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å
liq = insights['liquidity']
print(f"\n–õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å: {liq['score']:.2f}")
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

```python
async def should_buy_item(item_id: str, price: float) -> bool:
    """–†–µ—à–∏—Ç—å, —Å—Ç–æ–∏—Ç –ª–∏ –ø–æ–∫—É–ø–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏."""

    # –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
    price_history = await db.get_price_history(item_id, days=30)

    # –ê–Ω–∞–ª–∏–∑
    insights = analyzer.generate_trading_insights(price_history, price)

    recommendation = insights['overall']['recommendation']

    # –†–µ—à–µ–Ω–∏–µ
    if recommendation in ['STRONG BUY', 'BUY']:
        logger.info(
            "Buy recommended",
            item_id=item_id,
            recommendation=recommendation,
            score=insights['overall']['score']
        )
        return True

    elif recommendation in ['STRONG SELL', 'SELL']:
        logger.warning(
            "Buy NOT recommended",
            item_id=item_id,
            recommendation=recommendation
        )
        return False

    else:  # HOLD
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
        if insights.get('fair_price', {}).get('is_underpriced'):
            return True  # –ü–æ–∫—É–ø–∞—Ç—å –µ—Å–ª–∏ –Ω–µ–¥–æ–æ—Ü–µ–Ω–µ–Ω

        return False  # –ò–Ω–∞—á–µ –Ω–µ –ø–æ–∫—É–ø–∞—Ç—å
```

---

## üìä –ü—Ä–∏–º–µ—Ä: –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–º–µ—Ç–∞

```python
async def analyze_item(item_title: str):
    """–ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–º–µ—Ç–∞."""

    # 1. –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
    price_history = await db.get_price_history_by_title(
        item_title,
        days=30
    )

    current_price = await api_client.get_current_price(item_title)

    # 2. –°–æ–∑–¥–∞—Ç—å –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä
    analyzer = MarketAnalyzer(min_data_points=30)

    # 3. –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å insights
    insights = analyzer.generate_trading_insights(
        price_history,
        current_price
    )

    # 4. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç
    report = f"""
üìä –ê–Ω–∞–ª–∏–∑: {item_title}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üí∞ –¶–µ–Ω–∞
‚îú‚îÄ –¢–µ–∫—É—â–∞—è: ${current_price:.2f}
‚îú‚îÄ –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–∞—è: ${insights['fair_price']['value']:.2f}
‚îî‚îÄ –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ: {insights['fair_price']['deviation_percent']:.1f}%

üìà –¢—Ä–µ–Ω–¥: {insights['trend']['direction']}

üîÆ –ü—Ä–æ–≥–Ω–æ–∑
‚îú‚îÄ –ü–∞–¥–µ–Ω–∏–µ —Ü–µ–Ω—ã: {"–î–∞" if insights['price_prediction']['prediction'] else "–ù–µ—Ç"}
‚îú‚îÄ –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {insights['price_prediction']['confidence']:.1%}
‚îî‚îÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: {insights['price_prediction']['recommendation']}

üíß –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å: {insights['liquidity']['score']:.2f}

üéØ –£—Ä–æ–≤–Ω–∏
‚îú‚îÄ –ü–æ–¥–¥–µ—Ä–∂–∫–∞: ${min(insights['support_resistance']['support'], default=0):.2f}
‚îî‚îÄ –°–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ: ${max(insights['support_resistance']['resistance'], default=0):.2f}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úÖ –ò–¢–û–ì–û: {insights['overall']['recommendation']}
–û—Ü–µ–Ω–∫–∞: {insights['overall']['score']}/6
"""

    # 5. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram
    await notifier.send_notification(
        user_id=user.telegram_id,
        message=report,
        category="analytics"
    )

    return insights
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã

```python
import pytest
from src.utils.market_analytics import (
    MarketAnalyzer,
    PricePoint,
    TechnicalIndicators,
    TrendDirection
)

def test_rsi_overbought():
    """–¢–µ—Å—Ç RSI –¥–ª—è –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ–≥–æ —Ä—ã–Ω–∫–∞."""
    # –†–∞—Å—Ç—É—â–∏–µ —Ü–µ–Ω—ã
    prices = [10 + i * 0.5 for i in range(20)]

    rsi = TechnicalIndicators.rsi(prices)

    assert rsi is not None
    assert rsi > 70  # –ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–æ

def test_fair_price_calculation():
    """–¢–µ—Å—Ç —Ä–∞—Å—á–µ—Ç–∞ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–π —Ü–µ–Ω—ã."""
    analyzer = MarketAnalyzer()

    history = [
        PricePoint(datetime.now(UTC), 10.0, volume=100),
        PricePoint(datetime.now(UTC), 11.0, volume=150),
        PricePoint(datetime.now(UTC), 10.5, volume=120),
    ] * 10  # 30 —Ç–æ—á–µ–∫

    fair_price = analyzer.calculate_fair_price(history, method="mean")

    assert fair_price is not None
    assert 10.0 <= fair_price <= 11.0

def test_trend_detection():
    """–¢–µ—Å—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞."""
    analyzer = MarketAnalyzer()

    # –í–æ—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥
    rising_prices = [
        PricePoint(datetime.now(UTC), 10 + i * 0.1)
        for i in range(40)
    ]

    trend = analyzer.detect_trend(rising_prices)
    assert trend == TrendDirection.BULLISH
```

---

## üõ°Ô∏è Best Practices

### 1. –ú–∏–Ω–∏–º—É–º –¥–∞–Ω–Ω—ã—Ö

```python
# –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
MIN_DATA_POINTS = 30

if len(price_history) < MIN_DATA_POINTS:
    logger.warning("Insufficient data for analysis")
    return None
```

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ None

```python
# –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –≤–µ—Ä–Ω—É—Ç—å None
rsi = TechnicalIndicators.rsi(prices)

if rsi is None:
    logger.warning("Cannot calculate RSI")
    return {"signal": SignalType.HOLD}

# –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∞–Ω–∞–ª–∏–∑
```

### 3. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤

```python
# –ù–ï –ø–æ–ª–∞–≥–∞–π—Ç–µ—Å—å –Ω–∞ –æ–¥–∏–Ω –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
# –ö–æ–º–±–∏–Ω–∏—Ä—É–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–∏–≥–Ω–∞–ª–æ–≤

signals = []

rsi = TechnicalIndicators.rsi(prices)
if rsi and rsi < 30:
    signals.append("BUY")

macd = TechnicalIndicators.macd(prices)
if macd and macd["macd"] > macd["signal"]:
    signals.append("BUY")

# –†–µ—à–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞
buy_signals = sum(1 for s in signals if s == "BUY")
if buy_signals >= 2:
    return SignalType.BUY
```

### 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ –∞–Ω–∞–ª–∏–∑—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
logger.info(
    "Analysis completed",
    item_id=item_id,
    current_price=current_price,
    fair_price=fair_price,
    recommendation=recommendation
)
```

---

## üìö –°—Å—ã–ª–∫–∏

- [Technical Analysis](https://www.investopedia.com/technical-analysis-4689657)
- [RSI Indicator](https://www.investopedia.com/terms/r/rsi.asp)
- [MACD Indicator](https://www.investopedia.com/terms/m/macd.asp)
- [Bollinger Bands](https://www.investopedia.com/terms/b/bollingerbands.asp)

---

**–í–µ—Ä—Å–∏—è**: 1.0
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 23 –Ω–æ—è–±—Ä—è 2025 –≥.
