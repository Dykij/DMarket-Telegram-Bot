# üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç CI/CD

**–î–∞—Ç–∞**: 17 –¥–µ–∫–∞–±—Ä—è 2025 –≥.

---

## ‚úÖ –ß—Ç–æ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

### GitHub Actions Workflows

1. **CI Pipeline** (`.github/workflows/ci.yml`)
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ push/PR
   - ‚úÖ –õ–∏–Ω—Ç–∏–Ω–≥ (Ruff)
   - ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Ruff)
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ (MyPy)
   - ‚úÖ –¢–µ—Å—Ç—ã –Ω–∞ Python 3.10, 3.11, 3.12
   - ‚úÖ Security scan (Bandit, Safety)

2. **Code Quality** (`.github/workflows/quality.yml`)
   - ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞
   - ‚úÖ –ê–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (Radon, Xenon)
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ PR

3. **Coverage** (`.github/workflows/coverage.yml`)
   - ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ –ø–æ–∫—Ä—ã—Ç–∏—è
   - ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Codecov
   - ‚úÖ Coverage diff –¥–ª—è PR

4. **Release** (`.github/workflows/release.yml`)
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–ª–∏–∑ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–≥–∞
   - ‚úÖ –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–æ–≤ (multi-platform)
   - ‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ GitHub Container Registry
   - ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ GitHub Release —Å changelog

5. **Dependencies** (`.github/workflows/dependencies.yml`)
   - ‚úÖ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ PR —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏

---

## üì¶ –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ê–∫—Ç–∏–≤–∞—Ü–∏—è Pre-commit Hooks

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å pre-commit
pip install pre-commit

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ö—É–∫–∏
pre-commit install

# –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (–ø—Ä–æ–≤–µ—Ä–∏—Ç –≤—Å–µ —Ñ–∞–π–ª—ã)
pre-commit run --all-files
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Codecov (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ [codecov.io](https://codecov.io)
2. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ GitHub
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `DMarket-Telegram-Bot`
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω
5. –î–æ–±–∞–≤—å—Ç–µ –≤ GitHub Secrets:
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí Secrets and variables ‚Üí Actions
   - New repository secret
   - Name: `CODECOV_TOKEN`
   - Value: `<–≤–∞—à —Ç–æ–∫–µ–Ω>`

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã CI

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –≤–µ—Ç–∫—É
git checkout -b test/ci-setup

# –°–¥–µ–ª–∞–π—Ç–µ –Ω–µ–±–æ–ª—å—à–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
echo "# CI/CD Test" >> test_ci.md

# –ö–æ–º–º–∏—Ç –∏ push
git add test_ci.md
git commit -m "test: verify CI pipeline"
git push -u origin test/ci-setup

# –°–æ–∑–¥–∞–π—Ç–µ PR –Ω–∞ GitHub
# CI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è
```

---

## üîÑ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∞–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
ruff check . --fix
ruff format .

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
mypy src/

# 3. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pytest tests/ --cov=src

# 4. –ï—Å–ª–∏ –≤—Å—ë –û–ö - –∫–æ–º–º–∏—Ç
git add .
git commit -m "feat: add new feature"

# Pre-commit –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è
```

### –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PR

1. **–°–æ–∑–¥–∞–π—Ç–µ PR –Ω–∞ GitHub**
2. **–î–æ–∂–¥–∏—Ç–µ—Å—å CI** (–æ–±—ã—á–Ω–æ 3-5 –º–∏–Ω—É—Ç)
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**:
   - ‚úÖ –í—Å–µ —á–µ–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–µ–ª–µ–Ω—ã–º–∏
   - üìä –ü—Ä–æ–≤–µ—Ä—å—Ç–µ coverage –æ—Ç—á–µ—Ç
   - üí¨ –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

### –ï—Å–ª–∏ CI —É–ø–∞–ª

```bash
# 1. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ GitHub Actions
# 2. –ò—Å–ø—Ä–∞–≤—å—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –ª–æ–∫–∞–ª—å–Ω–æ
# 3. Push –∏–∑–º–µ–Ω–µ–Ω–∏–π

git add .
git commit -m "fix: resolve CI issues"
git push

# CI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è
```

---

## üéØ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ª–∏–∑–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ —Ç–µ–≥

```bash
# 1. –û–±–Ω–æ–≤–∏—Ç–µ –≤–µ—Ä—Å–∏—é –≤ —Ñ–∞–π–ª–∞—Ö
# pyproject.toml, src/__init__.py –∏ —Ç.–¥.

# 2. –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
git add .
git commit -m "chore: bump version to 1.0.0"
git push

# 3. –°–æ–∑–¥–∞–π—Ç–µ –∏ –∑–∞–ø—É—à—å—Ç–µ —Ç–µ–≥
git tag v1.0.0
git push origin v1.0.0

# Release workflow –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ GitHub UI

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Actions** ‚Üí **Release**
2. –ù–∞–∂–º–∏—Ç–µ **Run workflow**
3. –£–∫–∞–∂–∏—Ç–µ –≤–µ—Ä—Å–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1.0.0`)
4. –ù–∞–∂–º–∏—Ç–µ **Run workflow**

### –ü–æ—Å–ª–µ —Ä–µ–ª–∏–∑–∞

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç—Å—è:

- ‚úÖ GitHub Release —Å changelog
- ‚úÖ Docker –æ–±—Ä–∞–∑ –≤ ghcr.io
- ‚úÖ Artifacts (wheels, source distribution)

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ CI/CD

### GitHub Actions

- **–°—Ç–∞—Ç—É—Å**: <https://github.com/Dykij/DMarket-Telegram-Bot/actions>
- **Workflows**: –í—Å–µ workflows –≤ `.github/workflows/`
- **Artifacts**: –°–∫–∞—á–∞—Ç—å –º–æ–∂–Ω–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è workflow

### Codecov

- **Dashboard**: <https://codecov.io/gh/Dykij/DMarket-Telegram-Bot>
- **Coverage Trends**: –ì—Ä–∞—Ñ–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∫—Ä—ã—Ç–∏—è
- **File Browser**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –ø–æ —Ñ–∞–π–ª–∞–º

### Docker Images

```bash
# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ–±—Ä–∞–∑–æ–≤
docker images ghcr.io/dykij/dmarket-telegram-bot

# Pull –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏
docker pull ghcr.io/dykij/dmarket-telegram-bot:1.0.0
```

---

## üõ†Ô∏è –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### Pre-commit —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å pre-commit –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–º–º–∏—Ç–∞
git commit -m "message" --no-verify

# ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–¥–∫–æ, —Ç–æ–ª—å–∫–æ –≤ –∫—Ä–∞–π–Ω–∏—Ö —Å–ª—É—á–∞—è—Ö!
```

### CI –ø–∞–¥–∞–µ—Ç –Ω–∞ MyPy

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å MyPy –ª–æ–∫–∞–ª—å–Ω–æ —Å —Ç–µ–º–∏ –∂–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
mypy src/ --config-file=pyproject.toml

# –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤
# –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å # type: ignore –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
```

### Coverage —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
pytest tests/ --cov=src --cov-report=html
open htmlcov/index.html

# –ù–∞–π—Ç–∏ –Ω–µ–ø–æ–∫—Ä—ã—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
coverage report --show-missing

# –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–µ–ø–æ–∫—Ä—ã—Ç–æ–≥–æ –∫–æ–¥–∞
```

### Docker build –ø–∞–¥–∞–µ—Ç

```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
docker build -t dmarket-bot:test .

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker logs <container-id>

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Dockerfile
docker build --no-cache -t dmarket-bot:test .
```

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

```bash
# –ü–æ–ª–Ω–∞—è –ª–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–∫–∞–∫ –≤ CI)
make qa

# –ò–ª–∏ –ø–æ —á–∞—Å—Ç—è–º:
make lint      # –¢–æ–ª—å–∫–æ –ª–∏–Ω—Ç–∏–Ω–≥
make format    # –¢–æ–ª—å–∫–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
make typecheck # –¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
make test      # –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã
```

### –†–∞–±–æ—Ç–∞ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

```bash
# –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install --upgrade -r requirements.txt

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–∞–∫–µ—Ç—ã
pip list --outdated

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—è–∑–≤–∏–º–æ—Å—Ç–∏
pip-audit
safety check
```

### –†–∞–±–æ—Ç–∞ —Å Docker

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞
docker-compose build

# –ó–∞–ø—É—Å–∫
docker-compose up -d

# –õ–æ–≥–∏
docker-compose logs -f bot

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

---

## üéì –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- üìñ [–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è CI/CD](CI_CD_GUIDE.md)
- üîß [Code Quality Guide](code_quality_tools_guide.md)
- üß™ [Testing Guide](testing_guide.md)
- üê≥ [Deployment Guide](deployment.md)

---

## ‚úÖ Checklist –¥–ª—è contributors

- [ ] Pre-commit hooks —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] Coverage >= 80%
- [ ] MyPy –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞
- [ ] Ruff –ª–∏–Ω—Ç–∏–Ω–≥ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω—ã
- [ ] –ù–µ—Ç security warnings
- [ ] PR —Å–æ–∑–¥–∞–Ω —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] CI –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ

–í—Å–µ workflows –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º push –≤ `main` –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PR CI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è.
