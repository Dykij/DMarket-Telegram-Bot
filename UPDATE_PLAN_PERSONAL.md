# –ü–ª–∞–Ω –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (Single User)

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 20 –Ω–æ—è–±—Ä—è 2025 –≥.
**–†–µ–∂–∏–º**: üîí **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)**
**–§–æ–∫—É—Å**: –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, –ø—Ä–æ—Å—Ç–æ—Ç–∞, compliance —Å DMarket ToS
**–í–µ—Ä—Å–∏—è**: 1.0

---

## üéØ –¶–µ–ª–∏ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã

1. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –±–æ—Ç –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å 24/7 –±–µ–∑ —Å–±–æ–µ–≤
2. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è** - –º–∏–Ω–∏–º—É–º –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
3. **Compliance —Å ToS** - —Ç–æ–ª—å–∫–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ API, –±–µ–∑ reverse engineering
4. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –∞—Ä–±–∏—Ç—Ä–∞–∂** - –±—ã—Å—Ç—Ä–æ–µ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
5. **–ù–∏–∑–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è** - —Ä–∞–±–æ—Ç–∞ –Ω–∞ –æ–±—ã—á–Ω–æ–º VPS/–¥–æ–º–∞—à–Ω–µ–º –ü–ö

### –ß—Ç–æ –ù–ï –Ω—É–∂–Ω–æ –¥–ª—è 1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

- ‚ùå Webhooks (polling –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)
- ‚ùå Load balancing (–Ω–µ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏)
- ‚ùå Complex message queues (–Ω–µ—Ç –º–∞—Å—Å–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫)
- ‚ùå TreeFilters/web scraping (–Ω–∞—Ä—É—à–∞–µ—Ç ToS)

---

## ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —ç—Ç–∞–ø—ã (–¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å)

### –≠—Ç–∞–ø 1-4: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

- ‚úÖ **dmarket_api.py** - DMarket API v1.1.0 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ **market_models.py** - Pydantic 2.5+ –º–æ–¥–µ–ª–∏
- ‚úÖ **targets.py** - –£–º–Ω—ã–µ —Ç–∞—Ä–≥–µ—Ç—ã
- ‚úÖ **arbitrage_scanner.py** - –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **market_analysis.py** - –ê–Ω–∞–ª–∏–∑ –≥–ª—É–±–∏–Ω—ã —Ä—ã–Ω–∫–∞
- ‚úÖ **Handlers** - Target, Scanner, Formatters
- ‚úÖ **Tests** - 57 —Ç–µ—Å—Ç–æ–≤, –ø–æ–∫—Ä—ã—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

---

## üöÄ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –§–∞–∑–∞ 1: –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å (P1) - 7-10 –¥–Ω–µ–π

#### 1. Auto-recovery –∏ State Persistence ‚≠ê –ö–†–ò–¢–ò–ß–ù–û

**–¶–µ–ª—å**: –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ —Å–±–æ–µ–≤ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- Checkpoint —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–∫–∞–Ω–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫–∞–∂–¥—ã–µ 100 –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ checkpoint –ø—Ä–∏ restart
- Graceful shutdown handlers (SIGTERM/SIGINT)

**–ú–æ–¥—É–ª—å**: `src/utils/state_manager.py` (–ù–û–í–´–ô)

```python
class StateManager:
    async def save_checkpoint(scan_id, cursor, processed_items)
    async def load_checkpoint(scan_id) -> CheckpointData | None
    async def cleanup_old_checkpoints(days=7)
```

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL —Ç–∞–±–ª–∏—Ü–∞ `scan_checkpoints`

- scan_id (UUID)
- cursor (str)
- processed_items (int)
- timestamp (datetime)
- metadata (JSONB)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1
**–°—Ä–æ–∫**: 3 –¥–Ω—è
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: Batch processor (#3)

---

#### 2. Advanced Error Tracking —Å Sentry ‚≠ê –ö–†–ò–¢–ò–ß–ù–û

**–¶–µ–ª—å**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- Sentry SDK –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π capture –≤—Å–µ—Ö exceptions
- User context (user_id, command, parameters)
- Performance monitoring (–º–µ–¥–ª–µ–Ω–Ω—ã–µ API –≤—ã–∑–æ–≤—ã)
- Release tracking

**Alerting –ø—Ä–∞–≤–∏–ª–∞**:

- üî¥ **Critical**: API auth failures, database connection lost ‚Üí instant alert
- üü† **High**: Rate limit exceeded, OOM errors ‚Üí 5 min delay
- üü° **Medium**: Validation errors, single scan failures ‚Üí daily digest
- üîµ **Performance**: API calls > 5 seconds ‚Üí weekly report

**–ú–æ–¥—É–ª—å**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `src/utils/logging_utils.py`

```python
import sentry_sdk

sentry_sdk.init(
    dsn=os.getenv("SENTRY_DSN"),
    traces_sample_rate=0.1,  # 10% –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    send_default_pii=False,
    before_send=filter_sensitive_data
)
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1
**–°—Ä–æ–∫**: 2 –¥–Ω—è
**–°—Ç–æ–∏–º–æ—Å—Ç—å**: Sentry Free tier (5,000 errors/month) - –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ

---

#### 3. Simplified Batch Processing –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–∫–∞–Ω–æ–≤

**–¶–µ–ª—å**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—ã—Å—è—á –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –±–µ–∑ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –ø–∞–º—è—Ç–∏

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è single user**:

- Chunked processing –ø–æ 50-100 –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- –ü—Ä–æ—Å—Ç–∞—è asyncio.Queue (–Ω–µ –Ω—É–∂–Ω–∞ Celery/RabbitMQ)
- Memory cleanup –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏
- Progress tracking —á–µ—Ä–µ–∑ Telegram

**–ú–æ–¥—É–ª—å**: `src/utils/batch_processor.py` (–£–ü–†–û–©–ï–ù–ù–´–ô)

```python
class SimpleBatchProcessor:
    async def process_in_batches(
        items: list,
        batch_size: int = 100,
        process_fn: Callable,
        progress_callback: Callable | None = None
    ):
        for i in range(0, len(items), batch_size):
            batch = items[i:i+batch_size]
            await process_fn(batch)
            if progress_callback:
                await progress_callback(i + len(batch), len(items))
            await asyncio.sleep(0.1)  # Prevent overload
```

**Telegram progress**:

```
üîÑ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: 250/1000 –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (25%)
‚è±Ô∏è –û—Å—Ç–∞–ª–æ—Å—å: ~3 –º–∏–Ω—É—Ç—ã
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1
**–°—Ä–æ–∫**: 2 –¥–Ω—è
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –ù–µ—Ç

---

#### 4. Schema Validation –¥–ª—è API responses

**–¶–µ–ª—å**: –†–∞–Ω–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π API, –∑–∞—â–∏—Ç–∞ –æ—Ç runtime errors

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- Pydantic models –¥–ª—è –í–°–ï–• API responses
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ deserialization
- Clear error messages –ø—Ä–∏ schema mismatch
- Type safety –¥–ª—è downstream code

**–ú–æ–¥—É–ª—å**: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `src/dmarket/models/market_models.py`

**–ü—Ä–∏–º–µ—Ä**:

```python
from pydantic import BaseModel, Field, validator

class AggregatedPriceResponse(BaseModel):
    title: str
    order_best_price: str = Field(alias="orderBestPrice")
    order_count: int = Field(alias="orderCount")
    offer_best_price: str = Field(alias="offerBestPrice")
    offer_count: int = Field(alias="offerCount")

    @validator('order_best_price', 'offer_best_price')
    def validate_price(cls, v):
        if not v.isdigit():
            raise ValueError(f"Price must be numeric string, got {v}")
        return v
```

**Benefits**:

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ breaking changes –≤ API
- ‚úÖ IDE autocomplete –∏ type hints
- ‚úÖ Self-documenting code
- ‚úÖ Prevention runtime errors

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1
**–°—Ä–æ–∫**: 3 –¥–Ω—è
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: Pydantic 2.5+ (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

---

### –§–∞–∑–∞ 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –∫–∞—á–µ—Å—Ç–≤–æ –∂–∏–∑–Ω–∏ (P2) - 5-7 –¥–Ω–µ–π

#### 5. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è `/last-sales` endpoint –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –æ–±—ä–µ–º–∞
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥: ‚â•10 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞ 7 –¥–Ω–µ–π
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ txOperationType (Target/Offer)
- –ú–µ—Ç—Ä–∏–∫–∞ "trading velocity"

**–ú–æ–¥—É–ª—å**: `src/dmarket/liquidity_analyzer.py` (–ù–û–í–´–ô)

```python
class LiquidityAnalyzer:
    async def analyze_sales_volume(title: str, days: int = 7) -> int
    async def calculate_trading_velocity(title: str) -> float
    async def filter_by_liquidity(items: list, min_volume: int = 10) -> list
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P2
**–°—Ä–æ–∫**: 2 –¥–Ω—è

---

#### 6. –£–ª—É—á—à–µ–Ω–Ω–∞—è cursor-based –ø–∞–≥–∏–Ω–∞—Ü–∏—è

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- max_pages –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∫–∞–Ω–æ–≤
- Progress callbacks –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è –ø—Ä–µ—Ä–≤–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ—Ä–æ–≤
- Caching –∫—É—Ä—Å–æ—Ä–æ–≤ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ú–æ–¥—É–ª—å**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `src/dmarket/dmarket_api.py`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P2
**–°—Ä–æ–∫**: 1 –¥–µ–Ω—å

---

#### 7. Resource Monitor —Å auto-throttling

**–¶–µ–ª—å**: –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è single user**:

- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ CPU/Memory/Disk —Å psutil
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ (–Ω–µ –∫–∞–∂–¥—ã–µ 10 –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏)
- Auto-throttling –ø—Ä–∏ CPU > 80%, Memory > 85%
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ

**–ú–æ–¥—É–ª—å**: `src/utils/resource_monitor.py` (–£–ü–†–û–©–ï–ù–ù–´–ô)

```python
class ResourceMonitor:
    async def monitor_continuously(check_interval: int = 30):
        while True:
            cpu = psutil.cpu_percent()
            mem = psutil.virtual_memory().percent

            if cpu > 80 or mem > 85:
                await throttle_operations()

            await asyncio.sleep(check_interval)
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P2
**–°—Ä–æ–∫**: 2 –¥–Ω—è

---

#### 8. WebSocket –¥–ª—è real-time price updates

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏–∑ watchlist
- Real-time –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ü–µ–Ω –¥–ª—è –∞—Ä–±–∏—Ç—Ä–∞–∂–∞
- Instant —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö > 5%
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ REST API

**–ú–æ–¥—É–ª—å**: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `src/utils/websocket_client.py`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P2
**–°—Ä–æ–∫**: 3 –¥–Ω—è

---

### –§–∞–∑–∞ 3: –£–ª—É—á—à–µ–Ω–∏—è UX (P3) - 3-4 –¥–Ω—è

---

#### 9. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Polling –¥–ª—è Telegram

---

#### 10. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Polling –¥–ª—è Telegram

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è single user**:

- –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π timeout (30-60 —Å–µ–∫) –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
- `allowed_updates` —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω—É–∂–Ω—ã—Ö —Ç–∏–ø–æ–≤
- Graceful handling reconnections
- Minimal memory footprint

**–ú–æ–¥—É–ª—å**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `src/telegram_bot/enhanced_bot.py`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P3
**–°—Ä–æ–∫**: 0.5 –¥–Ω—è

---

#### 11. Personal Watchlist —Å Checklists

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- –ü—Ä–æ—Å—Ç–æ–π checklist –¥–ª—è –ª–∏—á–Ω–æ–≥–æ watchlist
- –û—Ç–º–µ—Ç–∫–∞ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ë–î
- –ë–µ–∑ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

**–ú–æ–¥—É–ª—å**: `src/telegram_bot/handlers/watchlist_handler.py` (–ù–û–í–´–ô)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P3
**–°—Ä–æ–∫**: 2 –¥–Ω—è

---

#### 12. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–∞—Ä–≥–µ—Ç—ã —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `floatPartValue`, `phase`, `paintSeed`
- –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ —á–µ—Ä–µ–∑ `/targets-by-title`
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–Ω—ã –Ω–∞ 10-20% –Ω–∏–∂–µ `offerBestPrice`

**–ú–æ–¥—É–ª—å**: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `src/dmarket/targets.py`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P2
**–°—Ä–æ–∫**: 3 –¥–Ω—è

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ (Single User Mode)

| #   | –ò–¥–µ—è                              | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ä–æ–∫    | –ú–æ–¥—É–ª—å                | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è    |
| --- | --------------------------------- | --------- | ------- | --------------------- | ----------- | --------------- |
| 1   | Auto-recovery & State Persistence | P1        | 3 –¥–Ω—è   | state_manager.py      | ‚≠ê‚≠ê‚≠ê         | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ   |
| 2   | Sentry Error Tracking             | P1        | 2 –¥–Ω—è   | logging_utils.py      | ‚≠ê‚≠ê‚≠ê         | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ   |
| 3   | Simplified Batch Processing       | P1        | 2 –¥–Ω—è   | batch_processor.py    | ‚≠ê‚≠ê          | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ   |
| 4   | API Schema Validation             | P1        | 3 –¥–Ω—è   | market_models.py      | ‚≠ê‚≠ê          | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ   |
| 5   | –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å           | P2        | 2 –¥–Ω—è   | liquidity_analyzer.py | ‚≠ê           | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |
| 6   | Cursor –ø–∞–≥–∏–Ω–∞—Ü–∏—è                  | P2        | 1 –¥–µ–Ω—å  | dmarket_api.py        | ‚≠ê           | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |
| 7   | Resource Monitor                  | P2        | 2 –¥–Ω—è   | resource_monitor.py   | ‚≠ê           | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |
| 8   | WebSocket real-time               | P2        | 3 –¥–Ω—è   | websocket_client.py   | ‚≠ê           | ‚úÖ –ü–æ–ª–µ–∑–Ω–æ       |
| 9   | Optimized Polling                 | P3        | 0.5 –¥–Ω—è | enhanced_bot.py       | -           | ‚úÖ –ü–æ–ª–µ–∑–Ω–æ       |
| 10  | Personal Watchlist                | P3        | 2 –¥–Ω—è   | watchlist_handler.py  | -           | ‚úÖ –ü–æ–ª–µ–∑–Ω–æ       |
| 11  | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–∞—Ä–≥–µ—Ç—ã              | P2        | 3 –¥–Ω—è   | targets.py            | ‚≠ê           | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |
| 12  | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ–º             | P2        | 3 –¥–Ω—è   | inventory_manager.py  | ‚≠ê           | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |
| 13  | Inline —Ä–µ–∂–∏–º + –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã         | P3        | 3-4 –¥–Ω—è | inline_handler.py     | -           | ‚úÖ –ü–æ–ª–µ–∑–Ω–æ       |

**–û–±—â–∏–π —Å—Ä–æ–∫**: ~25 –¥–Ω–µ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, **15-18 –¥–Ω–µ–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ**

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### Week 1: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (P1)

**–î–Ω–∏ 1-2**: Sentry Error Tracking (#2)
**–î–Ω–∏ 3-4**: Simplified Batch Processing (#3)
**–î–Ω–∏ 5-7**: Auto-recovery & State Persistence (#1)
**–î–Ω–∏ 8-10**: API Schema Validation (#4)

### Week 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (P2)

**–î–Ω–∏ 11-13**: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–∞—Ä–≥–µ—Ç—ã (#11)
**–î–Ω–∏ 14-15**: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å (#5)
**–î–µ–Ω—å 16**: Cursor –ø–∞–≥–∏–Ω–∞—Ü–∏—è (#6)
**–î–Ω–∏ 17-18**: Resource Monitor (#7)
**–î–Ω–∏ 19-21**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ–º (#12)

### Week 3: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (P2-P3)

**–î–Ω–∏ 22-24**: WebSocket real-time (#8)
**–î–Ω–∏ 25-26**: Personal Watchlist (#10)
**–î–µ–Ω—å 27**: Optimized Polling (#9)
**–î–Ω–∏ 28-30**: Inline —Ä–µ–∂–∏–º + –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (#13)

---

## üíª –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è (Single User)

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

**VPS/–°–µ—Ä–≤–µ—Ä**:

- CPU: 1 core (2 cores —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- RAM: 1 GB (2 GB —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- Disk: 5 GB SSD
- OS: Ubuntu 22.04 / Windows Server / –ª—é–±–æ–π —Å Docker

**–°–µ—Ç—å**:

- Stable internet (–Ω–µ –Ω—É–∂–µ–Ω –ø—É–±–ª–∏—á–Ω—ã–π IP –¥–ª—è polling —Ä–µ–∂–∏–º–∞)
- 100 MB/month –º–∏–Ω–∏–º—É–º (–¥–ª—è API calls –∏ Telegram)

**–ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ**:

- Python 3.10+
- PostgreSQL 14+ (–∏–ª–∏ SQLite –¥–ª—è –Ω–∞—á–∞–ª–∞)
- Docker + Docker Compose (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- Git

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

**Docker Compose**:

```yaml
version: '3.8'

services:
  bot:
    build: .
    restart: unless-stopped
    env_file: .env
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
    depends_on:
      - postgres
      - redis

  postgres:
    image: postgres:15-alpine
    restart: unless-stopped
    environment:
      POSTGRES_DB: dmarket_bot
      POSTGRES_USER: dmarketbot
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    restart: unless-stopped
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:
```

---

## üõ°Ô∏è ToS Compliance Checklist

### ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–æ (–∏—Å–ø–æ–ª—å–∑—É–µ–º)

- ‚úÖ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ DMarket API endpoints
- ‚úÖ HMAC-SHA256 authentication –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- ‚úÖ Rate limiting –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ª–∏–º–∏—Ç–æ–≤ (30 req/min)
- ‚úÖ Cursor-based –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- ‚úÖ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (priceFrom/To, exterior[], etc.)

### ‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ (–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º)

- ‚ùå Web scraping —á–µ—Ä–µ–∑ Selenium/Playwright
- ‚ùå Reverse-engineering –Ω–µ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö API
- ‚ùå DevTools network inspection –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚ùå TreeFilters —á–µ—Ä–µ–∑ reverse engineering
- ‚ùå Rate limit –æ–±—Ö–æ–¥ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏
- ‚ùå Fake user agents –∏–ª–∏ bot detection bypass

---

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ Uptime > 99.5% (max 3.6 —á–∞—Å–∞ –ø—Ä–æ—Å—Ç–æ—è/–º–µ—Å—è—Ü)
- ‚úÖ Auto-recovery < 5 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ crash
- ‚úÖ Zero data loss –ø—Ä–∏ restart

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ Scan 1000 –ø—Ä–µ–¥–º–µ—Ç–æ–≤ < 5 –º–∏–Ω—É—Ç
- ‚úÖ API response time < 2 —Å–µ–∫—É–Ω–¥—ã (95th percentile)
- ‚úÖ Memory usage < 512 MB (steady state)

### –ö–∞—á–µ—Å—Ç–≤–æ

- ‚úÖ Sentry errors < 10/–¥–µ–Ω—å
- ‚úÖ False positive –∞—Ä–±–∏—Ç—Ä–∞–∂–∞ < 5%
- ‚úÖ Test coverage > 80% –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥—É–ª–µ–π

---

## üîß Maintenance Plan

### –ï–∂–µ–¥–Ω–µ–≤–Ω–æ

- –ü—Ä–æ–≤–µ—Ä–∫–∞ Sentry –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ uptime (—á–µ—Ä–µ–∑ health check)

### –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ

- –û–±–∑–æ—Ä Sentry digest
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –Ω–∞ –∞–Ω–æ–º–∞–ª–∏–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### –ï–∂–µ–º–µ—Å—è—á–Ω–æ

- Backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö checkpoints (> 30 –¥–Ω–µ–π)
- –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

### Backup —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):

```bash
#!/bin/bash
# cron: 0 3 * * * (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00)

DATE=$(date +%Y%m%d)
docker exec postgres pg_dump -U dmarketbot dmarket_bot > backup_${DATE}.sql
find . -name "backup_*.sql" -mtime +30 -delete
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:

- .env —Ñ–∞–π–ª ‚Üí –∑–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –∏ —Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
- docker-compose.yml ‚Üí git repository

### Security best practices

- ‚úÖ API –∫–ª—é—á–∏ –≤ .env (NEVER –≤ –∫–æ–¥–µ)
- ‚úÖ PostgreSQL password —Å–∏–ª—å–Ω—ã–π (20+ —Å–∏–º–≤–æ–ª–æ–≤)
- ‚úÖ Sentry DSN –Ω–µ –ø—É–±–ª–∏—á–Ω—ã–π
- ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ 2FA –Ω–∞ –≤—Å–µ—Ö –∞–∫–∫–∞—É–Ω—Ç–∞—Ö (DMarket, Telegram, Sentry)

---

**–û–±–Ω–æ–≤–ª–µ–Ω–æ**: 20 –Ω–æ—è–±—Ä—è 2025 –≥.
**–°—Ç–∞—Ç—É—Å**: –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–¥ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (single user)
**–í–µ—Ä—Å–∏—è**: 2.0 - –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –ø–æ–ª–µ–∑–Ω—ã–µ –∏–¥–µ–∏ –∏–∑ UPDATE_PLAN.md (–±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è ToS)
**Compliance**: ‚úÖ –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ DMarket ToS
