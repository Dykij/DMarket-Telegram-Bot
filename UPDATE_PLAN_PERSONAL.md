# –ü–ª–∞–Ω –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (Single User)

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 20 –Ω–æ—è–±—Ä—è 2025 –≥.
**–†–µ–∂–∏–º**: üîí **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)**
**–§–æ–∫—É—Å**: –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, –ø—Ä–æ—Å—Ç–æ—Ç–∞, compliance —Å DMarket ToS
**–í–µ—Ä—Å–∏—è**: 1.0

---

## üéØ –¶–µ–ª–∏ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã

1. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –±–æ—Ç –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å 24/7 –±–µ–∑ —Å–±–æ–µ–≤
2. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è** - –º–∏–Ω–∏–º—É–º –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
3. **Compliance —Å ToS** - —Ç–æ–ª—å–∫–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ API, –±–µ–∑ reverse engineering
4. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –∞—Ä–±–∏—Ç—Ä–∞–∂** - –±—ã—Å—Ç—Ä–æ–µ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
5. **–ù–∏–∑–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è** - —Ä–∞–±–æ—Ç–∞ –Ω–∞ –æ–±—ã—á–Ω–æ–º VPS/–¥–æ–º–∞—à–Ω–µ–º –ü–ö

### –ß—Ç–æ –ù–ï –Ω—É–∂–Ω–æ –¥–ª—è 1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

- ‚ùå Webhooks (polling –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)
- ‚ùå Load balancing (–Ω–µ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏)
- ‚ùå Complex message queues (–Ω–µ—Ç –º–∞—Å—Å–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫)
- ‚ùå TreeFilters/web scraping (–Ω–∞—Ä—É—à–∞–µ—Ç ToS)

---

## ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —ç—Ç–∞–ø—ã (–¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å)

### –≠—Ç–∞–ø 1-4: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

- ‚úÖ **dmarket_api.py** - DMarket API v1.1.0 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ **market_models.py** - Pydantic 2.5+ –º–æ–¥–µ–ª–∏
- ‚úÖ **targets.py** - –£–º–Ω—ã–µ —Ç–∞—Ä–≥–µ—Ç—ã
- ‚úÖ **arbitrage_scanner.py** - –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **market_analysis.py** - –ê–Ω–∞–ª–∏–∑ –≥–ª—É–±–∏–Ω—ã —Ä—ã–Ω–∫–∞
- ‚úÖ **Handlers** - Target, Scanner, Formatters
- ‚úÖ **Tests** - 57 —Ç–µ—Å—Ç–æ–≤, –ø–æ–∫—Ä—ã—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –§–∞–∑–∞ 1 (P1): ‚úÖ –ó–ê–í–ï–†–®–ï–ù–ê - 4/4 (20 –Ω–æ—è–±—Ä—è 2025)

#### ‚úÖ 1. Auto-recovery & State Persistence - –ó–ê–í–ï–†–®–ï–ù–û

- ‚úÖ StateManager —Å checkpoint system
- ‚úÖ Graceful shutdown handlers (SIGTERM/SIGINT)
- ‚úÖ Database model ScanCheckpoint
- ‚úÖ LocalStateManager –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (file-based)
- ‚úÖ Cleanup old checkpoints
- ‚úÖ Recovery mechanisms
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ docs/state_management_guide.md

**–°—Ç–∞—Ç—É—Å**: –¢—Ä–µ–±—É–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î ‚ö†Ô∏è
**–§–∞–π–ª—ã**:

- `src/utils/state_manager.py` (–Ω–æ–≤—ã–π, 450+ —Å—Ç—Ä–æ–∫)
- `docs/state_management_guide.md` (–Ω–æ–≤—ã–π, –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ)
**TODO**: –°–æ–∑–¥–∞—Ç—å Alembic –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è scan_checkpoints

#### ‚úÖ 2. Sentry Error Tracking - –ó–ê–í–ï–†–®–ï–ù–û

- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Sentry SDK –≤ logging_utils.py
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π capture –≤—Å–µ—Ö exceptions
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ LoggingIntegration, AsyncioIntegration, HttpxIntegration
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω .env.example —Å SENTRY_DSN –∏ BOT_VERSION
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: error tracking –≤—Å—Ç—Ä–æ–µ–Ω –≤ setup_logging()

**–°—Ç–∞—Ç—É—Å**: Production Ready ‚úÖ
**–§–∞–π–ª—ã**:

- `src/utils/logging_utils.py` (–æ–±–Ω–æ–≤–ª–µ–Ω)
- `.env.example` (–æ–±–Ω–æ–≤–ª–µ–Ω)

#### ‚úÖ 3. Simplified Batch Processing - –ó–ê–í–ï–†–®–ï–ù–û

- ‚úÖ SimpleBatchProcessor –¥–ª—è memory-efficient –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ Concurrent processing —Å semaphore control
- ‚úÖ ProgressTracker –¥–ª—è real-time progress
- ‚úÖ Chunked API calls –¥–ª—è rate limiting
- ‚úÖ Error handling —Å callbacks
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ docs/batch_processing_guide.md

**–°—Ç–∞—Ç—É—Å**: Production Ready ‚úÖ
**–§–∞–π–ª—ã**:

- `src/utils/batch_processor.py` (–Ω–æ–≤—ã–π, 280+ —Å—Ç—Ä–æ–∫)
- `docs/batch_processing_guide.md` (–Ω–æ–≤—ã–π, –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ)

#### ‚úÖ 4. API Schema Validation - –ó–ê–í–ï–†–®–ï–ù–û

- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ Pydantic models –¥–ª—è –í–°–ï–• API responses
- ‚úÖ MarketItemsResponse, AggregatedPricesResponse
- ‚úÖ UserTargetsResponse, UserOffersResponse, UserInventoryResponse
- ‚úÖ BuyItemResponse, CreateOfferResponse
- ‚úÖ LastSalesResponse, ClosedTargetsResponse
- ‚úÖ OffersByTitleResponse, InventoryItem
- ‚úÖ Properties –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Å–∏–π (—Ü–µ–Ω—Ç—ã ‚Üí –¥–æ–ª–ª–∞—Ä—ã)
- ‚úÖ Validation –Ω–∞ –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è
- ‚úÖ Clear error messages –ø—Ä–∏ schema mismatch
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ docs/schema_validation_guide.md
- ‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ: 11/11 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ (100%)

**–°—Ç–∞—Ç—É—Å**: Production Ready ‚úÖ
**–§–∞–π–ª—ã**:

- `src/dmarket/models/market_models.py` (—Ä–∞—Å—à–∏—Ä–µ–Ω, 600+ —Å—Ç—Ä–æ–∫)
- `docs/schema_validation_guide.md` (–Ω–æ–≤—ã–π, –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ)
**TODO**: Unit —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π

---

## üéâ –§–∞–∑–∞ 1 - –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–ê! (20 –Ω–æ—è–±—Ä—è 2025)

**–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è**:

- ‚úÖ 4/4 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- ‚úÖ Auto-recovery –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ 24/7
- ‚úÖ Sentry –¥–ª—è real-time error tracking
- ‚úÖ Batch processing –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- ‚úÖ Schema validation –¥–ª—è type safety
- ‚úÖ 1,800+ —Å—Ç—Ä–æ–∫ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞
- ‚úÖ 4 –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã—Ö —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞

**–°–ª–µ–¥—É—é—â–∞—è —Ñ–∞–∑–∞**: P2 - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –∫–∞—á–µ—Å—Ç–≤–æ –∂–∏–∑–Ω–∏

---

## üöÄ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –§–∞–∑–∞ 1: –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å (P1) - 7-10 –¥–Ω–µ–π

#### 1. Auto-recovery –∏ State Persistence ‚≠ê –ö–†–ò–¢–ò–ß–ù–û

**–¶–µ–ª—å**: –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ —Å–±–æ–µ–≤ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- Checkpoint —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–∫–∞–Ω–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫–∞–∂–¥—ã–µ 100 –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ checkpoint –ø—Ä–∏ restart
- Graceful shutdown handlers (SIGTERM/SIGINT)

**–ú–æ–¥—É–ª—å**: `src/utils/state_manager.py` (–ù–û–í–´–ô)

```python
class StateManager:
    async def save_checkpoint(scan_id, cursor, processed_items)
    async def load_checkpoint(scan_id) -> CheckpointData | None
    async def cleanup_old_checkpoints(days=7)
```

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL —Ç–∞–±–ª–∏—Ü–∞ `scan_checkpoints`

- scan_id (UUID)
- cursor (str)
- processed_items (int)
- timestamp (datetime)
- metadata (JSONB)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1
**–°—Ä–æ–∫**: 3 –¥–Ω—è
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: Batch processor (#3)

---

#### 2. Advanced Error Tracking —Å Sentry ‚≠ê –ö–†–ò–¢–ò–ß–ù–û

**–¶–µ–ª—å**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- Sentry SDK –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π capture –≤—Å–µ—Ö exceptions
- User context (user_id, command, parameters)
- Performance monitoring (–º–µ–¥–ª–µ–Ω–Ω—ã–µ API –≤—ã–∑–æ–≤—ã)
- Release tracking

**Alerting –ø—Ä–∞–≤–∏–ª–∞**:

- üî¥ **Critical**: API auth failures, database connection lost ‚Üí instant alert
- üü† **High**: Rate limit exceeded, OOM errors ‚Üí 5 min delay
- üü° **Medium**: Validation errors, single scan failures ‚Üí daily digest
- üîµ **Performance**: API calls > 5 seconds ‚Üí weekly report

**–ú–æ–¥—É–ª—å**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `src/utils/logging_utils.py`

```python
import sentry_sdk

sentry_sdk.init(
    dsn=os.getenv("SENTRY_DSN"),
    traces_sample_rate=0.1,  # 10% –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    send_default_pii=False,
    before_send=filter_sensitive_data
)
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1
**–°—Ä–æ–∫**: 2 –¥–Ω—è
**–°—Ç–æ–∏–º–æ—Å—Ç—å**: Sentry Free tier (5,000 errors/month) - –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ

---

#### 3. Simplified Batch Processing –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–∫–∞–Ω–æ–≤

**–¶–µ–ª—å**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—ã—Å—è—á –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –±–µ–∑ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –ø–∞–º—è—Ç–∏

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è single user**:

- Chunked processing –ø–æ 50-100 –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- –ü—Ä–æ—Å—Ç–∞—è asyncio.Queue (–Ω–µ –Ω—É–∂–Ω–∞ Celery/RabbitMQ)
- Memory cleanup –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏
- Progress tracking —á–µ—Ä–µ–∑ Telegram

**–ú–æ–¥—É–ª—å**: `src/utils/batch_processor.py` (–£–ü–†–û–©–ï–ù–ù–´–ô)

```python
class SimpleBatchProcessor:
    async def process_in_batches(
        items: list,
        batch_size: int = 100,
        process_fn: Callable,
        progress_callback: Callable | None = None
    ):
        for i in range(0, len(items), batch_size):
            batch = items[i:i+batch_size]
            await process_fn(batch)
            if progress_callback:
                await progress_callback(i + len(batch), len(items))
            await asyncio.sleep(0.1)  # Prevent overload
```

**Telegram progress**:

```
üîÑ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: 250/1000 –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (25%)
‚è±Ô∏è –û—Å—Ç–∞–ª–æ—Å—å: ~3 –º–∏–Ω—É—Ç—ã
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1
**–°—Ä–æ–∫**: 2 –¥–Ω—è
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –ù–µ—Ç

---

#### 4. Schema Validation –¥–ª—è API responses

**–¶–µ–ª—å**: –†–∞–Ω–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π API, –∑–∞—â–∏—Ç–∞ –æ—Ç runtime errors

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- Pydantic models –¥–ª—è –í–°–ï–• API responses
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ deserialization
- Clear error messages –ø—Ä–∏ schema mismatch
- Type safety –¥–ª—è downstream code

**–ú–æ–¥—É–ª—å**: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `src/dmarket/models/market_models.py`

**–ü—Ä–∏–º–µ—Ä**:

```python
from pydantic import BaseModel, Field, validator

class AggregatedPriceResponse(BaseModel):
    title: str
    order_best_price: str = Field(alias="orderBestPrice")
    order_count: int = Field(alias="orderCount")
    offer_best_price: str = Field(alias="offerBestPrice")
    offer_count: int = Field(alias="offerCount")

    @validator('order_best_price', 'offer_best_price')
    def validate_price(cls, v):
        if not v.isdigit():
            raise ValueError(f"Price must be numeric string, got {v}")
        return v
```

**Benefits**:

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ breaking changes –≤ API
- ‚úÖ IDE autocomplete –∏ type hints
- ‚úÖ Self-documenting code
- ‚úÖ Prevention runtime errors

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1
**–°—Ä–æ–∫**: 3 –¥–Ω—è
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: Pydantic 2.5+ (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

---

### –§–∞–∑–∞ 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –∫–∞—á–µ—Å—Ç–≤–æ –∂–∏–∑–Ω–∏ (P2) - 5-7 –¥–Ω–µ–π

#### ‚úÖ 5. Circuit Breaker Pattern –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤ - –ó–ê–í–ï–†–®–ï–ù–û

**–¶–µ–ª—å**: –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤ –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ `CircuitBreaker` (–±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
- ‚úÖ Circuit breaker –¥–ª—è DMarket API
- ‚úÖ –¢—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è: Closed (–Ω–æ—Ä–º–∞), Open (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞), Half-Open (–ø—Ä–æ–≤–µ—Ä–∫–∞)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞: 5 failures –∑–∞ 60 —Å–µ–∫—É–Ω–¥ ‚Üí Open (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ 60 —Å–µ–∫)
- ‚úÖ Fallback strategies: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ Monitoring integration (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è)

**–ú–æ–¥—É–ª—å**: `src/utils/api_circuit_breaker.py` (–ù–û–í–´–ô) –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `src/dmarket/dmarket_api.py`

**Benefits**:

- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ —Å–±–æ—è—Ö API
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π fail-fast –≤–º–µ—Å—Ç–æ —Ç–∞–π–º–∞—É—Ç–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ downtime
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ (threads, connections)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1 (–ø–æ–≤—ã—à–µ–Ω —Å P2)
**–°—Ä–æ–∫**: 2 –¥–Ω—è
**–°—Ç–∞—Ç—É—Å**: Production Ready ‚úÖ

---

#### ‚úÖ 6. Database Connection Pooling & Optimization - –ó–ê–í–ï–†–®–ï–ù–û

**–¶–µ–ª—å**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ë–î, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ connection exhaustion

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- ‚úÖ SQLAlchemy connection pool configuration (QueuePool)
- ‚úÖ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª–µ–π (telegram_id, item_id, timestamps)
- ‚úÖ Connection health checks (`pool_pre_ping=True`)
- ‚úÖ Pool size tuning –¥–ª—è single-user —Ä–µ–∂–∏–º–∞ (size=5, overflow=10)

**–ú–æ–¥—É–ª—å**: –û–±–Ω–æ–≤–ª–µ–Ω `src/utils/database.py`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1 (–ø–æ–≤—ã—à–µ–Ω —Å P2)
**–°—Ä–æ–∫**: 2 –¥–Ω—è
**–°—Ç–∞—Ç—É—Å**: Production Ready ‚úÖ

---

#### 7. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è `/last-sales` endpoint –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –æ–±—ä–µ–º–∞
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥: ‚â•10 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞ 7 –¥–Ω–µ–π
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ txOperationType (Target/Offer)
- –ú–µ—Ç—Ä–∏–∫–∞ "trading velocity"

**–ú–æ–¥—É–ª—å**: `src/dmarket/liquidity_analyzer.py` (–ù–û–í–´–ô)

```python
class LiquidityAnalyzer:
    async def analyze_sales_volume(title: str, days: int = 7) -> int
    async def calculate_trading_velocity(title: str) -> float
    async def filter_by_liquidity(items: list, min_volume: int = 10) -> list
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P2
**–°—Ä–æ–∫**: 2 –¥–Ω—è

---

#### 6. –£–ª—É—á—à–µ–Ω–Ω–∞—è cursor-based –ø–∞–≥–∏–Ω–∞—Ü–∏—è

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- max_pages –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∫–∞–Ω–æ–≤
- Progress callbacks –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è –ø—Ä–µ—Ä–≤–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ—Ä–æ–≤
- Caching –∫—É—Ä—Å–æ—Ä–æ–≤ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ú–æ–¥—É–ª—å**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `src/dmarket/dmarket_api.py`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P2
**–°—Ä–æ–∫**: 1 –¥–µ–Ω—å

---

#### 7. Resource Monitor —Å auto-throttling

**–¶–µ–ª—å**: –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è single user**:

- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ CPU/Memory/Disk —Å psutil
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ (–Ω–µ –∫–∞–∂–¥—ã–µ 10 –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏)
- Auto-throttling –ø—Ä–∏ CPU > 80%, Memory > 85%
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ

**–ú–æ–¥—É–ª—å**: `src/utils/resource_monitor.py` (–£–ü–†–û–©–ï–ù–ù–´–ô)

```python
class ResourceMonitor:
    async def monitor_continuously(check_interval: int = 30):
        while True:
            cpu = psutil.cpu_percent()
            mem = psutil.virtual_memory().percent

            if cpu > 80 or mem > 85:
                await throttle_operations()

            await asyncio.sleep(check_interval)
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P2
**–°—Ä–æ–∫**: 2 –¥–Ω—è

---

#### 8. Enhanced Monitoring —Å Grafana Dashboards ‚≠ê –í–ê–ñ–ù–û

**–¶–µ–ª—å**: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ –∏ –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- Grafana –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ Prometheus –º–µ—Ç—Ä–∏–∫
- Custom dashboards –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö KPI:
  - API response times (p50, p95, p99)
  - Error rates –ø–æ —Ç–∏–ø–∞–º
  - Arbitrage opportunities found/hour
  - Target execution success rate
  - Memory/CPU usage trends
- Alerting rules —á–µ—Ä–µ–∑ Grafana Alerts:
  - üî¥ Critical: API auth failure ‚Üí Telegram alert
  - üü† High: Error rate > 10/min ‚Üí Email
  - üü° Medium: Slow queries > 5s ‚Üí Daily digest
- Integration —Å Telegram –¥–ª—è alerts

**–ú–æ–¥—É–ª—å**: Docker Compose –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ Grafana

```yaml
# docker-compose.yml
grafana:
  image: grafana/grafana:latest
  restart: unless-stopped
  ports:
    - "3000:3000"
  environment:
    - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD}
  volumes:
    - grafana_data:/var/lib/grafana
    - ./config/grafana/dashboards:/etc/grafana/provisioning/dashboards
```

**Pre-configured dashboards**:

- Bot Health Overview
- API Performance Metrics
- Trading Activity Dashboard
- Error Tracking & Logs

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P2
**–°—Ä–æ–∫**: 2 –¥–Ω—è
**–°—Ç–æ–∏–º–æ—Å—Ç—å**: Free (self-hosted)

---

#### 9. Security Hardening & Automated Audits

**–¶–µ–ª—å**: –†–µ–≥—É–ª—è—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- Bandit –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- Trivy –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è Docker –æ–±—Ä–∞–∑–æ–≤
- Safety –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ known vulnerabilities –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
- pre-commit hooks –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
- GitHub Dependabot alerts (—É–∂–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω)

**–ú–æ–¥—É–ª—å**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ CI/CD pipeline

```yaml
# .github/workflows/security.yml
name: Security Audit

on: [push, pull_request]

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Run Bandit
        run: |
          pip install bandit
          bandit -r src/ -f json -o bandit-report.json

      - name: Run Safety
        run: |
          pip install safety
          safety check --json

      - name: Scan Docker Image
        run: |
          docker build -t dmarket-bot:scan .
          trivy image dmarket-bot:scan
```

**Pre-commit configuration**:

```yaml
# .pre-commit-config.yaml
repos:
  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.5
    hooks:
      - id: bandit
        args: ['-c', 'pyproject.toml']
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P2
**–°—Ä–æ–∫**: 1 –¥–µ–Ω—å
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: `pip install bandit safety`

---

#### 10. Load & Stress Testing Suite

**–¶–µ–ª—å**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π, –ø–æ–∏—Å–∫ bottlenecks

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- Locust –¥–ª—è load testing REST API endpoints
- Chaos testing –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ —Å–±–æ–µ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- Performance benchmarks –¥–ª—è critical paths
- Memory leak detection —Å tracemalloc
- CI integration –¥–ª—è regression testing

**–ú–æ–¥—É–ª—å**: `tests/performance/` (–ù–û–í–´–ô)

```python
# tests/performance/locustfile.py
from locust import HttpUser, task, between

class BotLoadTest(HttpUser):
    wait_time = between(1, 3)

    @task(3)
    def scan_arbitrage(self):
        self.client.get("/api/arbitrage/scan?game=csgo&level=standard")

    @task(1)
    def get_targets(self):
        self.client.get("/api/targets?status=active")
```

**Load test scenarios**:

- Arbitrage scanning: 100 concurrent scans
- Target creation: burst of 50 targets/second
- Database queries: 1000 reads/second
- WebSocket connections: 10 simultaneous streams

**Acceptance criteria**:

- ‚úÖ API response time < 2s under 100 RPS
- ‚úÖ Memory usage stable < 1GB during 1-hour test
- ‚úÖ No connection pool exhaustion
- ‚úÖ Error rate < 1% under load

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P3
**–°—Ä–æ–∫**: 2 –¥–Ω—è
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: `pip install locust pytest-benchmark`

---

#### 11. WebSocket –¥–ª—è real-time price updates

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏–∑ watchlist
- Real-time –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ü–µ–Ω –¥–ª—è –∞—Ä–±–∏—Ç—Ä–∞–∂–∞
- Instant —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö > 5%
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ REST API

**–ú–æ–¥—É–ª—å**: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `src/utils/websocket_client.py`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P2
**–°—Ä–æ–∫**: 3 –¥–Ω—è

---

### –§–∞–∑–∞ 3: –£–ª—É—á—à–µ–Ω–∏—è UX (P3) - 3-4 –¥–Ω—è

---

#### 12. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Polling –¥–ª—è Telegram

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è single user**:

- –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π timeout (30-60 —Å–µ–∫) –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
- `allowed_updates` —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω—É–∂–Ω—ã—Ö —Ç–∏–ø–æ–≤
- Graceful handling reconnections
- Minimal memory footprint

**–ú–æ–¥—É–ª—å**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `src/telegram_bot/enhanced_bot.py`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P3
**–°—Ä–æ–∫**: 0.5 –¥–Ω—è

---

#### 13. Personal Watchlist —Å Checklists

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- –ü—Ä–æ—Å—Ç–æ–π checklist –¥–ª—è –ª–∏—á–Ω–æ–≥–æ watchlist
- –û—Ç–º–µ—Ç–∫–∞ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ë–î
- –ë–µ–∑ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

**–ú–æ–¥—É–ª—å**: `src/telegram_bot/handlers/watchlist_handler.py` (–ù–û–í–´–ô)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P3
**–°—Ä–æ–∫**: 2 –¥–Ω—è

---

#### 14. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–∞—Ä–≥–µ—Ç—ã —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `floatPartValue`, `phase`, `paintSeed`
- –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ —á–µ—Ä–µ–∑ `/targets-by-title`
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–Ω—ã –Ω–∞ 10-20% –Ω–∏–∂–µ `offerBestPrice`

**–ú–æ–¥—É–ª—å**: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `src/dmarket/targets.py`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P2
**–°—Ä–æ–∫**: 3 –¥–Ω—è

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ (Single User Mode) - –û–ë–ù–û–í–õ–ï–ù–û

| #   | –ò–¥–µ—è                                    | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ä–æ–∫       | –ú–æ–¥—É–ª—å                     | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è        |
| --- | --------------------------------------- | --------- | ---------- | -------------------------- | ----------- | ------------------- |
| 1   | ‚úÖ **Auto-recovery & State Persistence** | P1        | 3 –¥–Ω—è      | state_manager.py           | ‚≠ê‚≠ê‚≠ê         | **‚úÖ –ó–ê–í–ï–†–®–ï–ù–û**     |
| 2   | ‚úÖ **Sentry Error Tracking**             | P1        | 2 –¥–Ω—è      | logging_utils.py           | ‚≠ê‚≠ê‚≠ê         | **‚úÖ –ó–ê–í–ï–†–®–ï–ù–û**     |
| 3   | ‚úÖ **Simplified Batch Processing**       | P1        | 2 –¥–Ω—è      | batch_processor.py         | ‚≠ê‚≠ê          | **‚úÖ –ó–ê–í–ï–†–®–ï–ù–û**     |
| 4   | ‚úÖ **API Schema Validation**             | P1        | 3 –¥–Ω—è      | market_models.py           | ‚≠ê‚≠ê          | **‚úÖ –ó–ê–í–ï–†–®–ï–ù–û**     |
| 5   | ‚úÖ **Circuit Breaker Pattern**           | **P1**    | **2 –¥–Ω—è**  | **api_circuit_breaker.py** | **‚≠ê‚≠ê‚≠ê**     | **‚úÖ –ó–ê–í–ï–†–®–ï–ù–û**     |
| 6   | ‚úÖ **Database Connection Pooling**       | **P1**    | **2 –¥–Ω—è**  | **database.py**            | **‚≠ê‚≠ê**      | **‚úÖ –ó–ê–í–ï–†–®–ï–ù–û**     |
| 7   | –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å                 | P2        | 2 –¥–Ω—è      | liquidity_analyzer.py      | ‚≠ê           | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è     |
| 8   | **Enhanced Monitoring (Grafana)**       | **P2**    | **2 –¥–Ω—è**  | **docker-compose.yml**     | **‚≠ê‚≠ê**      | **‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** |
| 9   | **Security Hardening (Bandit)**         | **P2**    | **1 –¥–µ–Ω—å** | **CI/CD**                  | **‚≠ê**       | **‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** |
| 10  | **Load & Stress Testing**               | **P3**    | **2 –¥–Ω—è**  | **tests/performance/**     | **‚≠ê**       | **‚úÖ –ü–æ–ª–µ–∑–Ω–æ**       |
| 11  | WebSocket real-time                     | P2        | 3 –¥–Ω—è      | websocket_client.py        | ‚≠ê           | ‚úÖ –ü–æ–ª–µ–∑–Ω–æ           |
| 12  | Optimized Polling                       | P3        | 0.5 –¥–Ω—è    | enhanced_bot.py            | -           | ‚úÖ –ü–æ–ª–µ–∑–Ω–æ           |
| 13  | Personal Watchlist                      | P3        | 2 –¥–Ω—è      | watchlist_handler.py       | -           | ‚úÖ –ü–æ–ª–µ–∑–Ω–æ           |
| 14  | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–∞—Ä–≥–µ—Ç—ã                    | P2        | 3 –¥–Ω—è      | targets.py                 | ‚≠ê           | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è     |
| 15  | Cursor –ø–∞–≥–∏–Ω–∞—Ü–∏—è                        | P2        | 1 –¥–µ–Ω—å     | dmarket_api.py             | ‚≠ê           | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è     |
| 16  | Resource Monitor                        | P2        | 2 –¥–Ω—è      | resource_monitor.py        | ‚≠ê           | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è     |
| 17  | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ–º                   | P2        | 3 –¥–Ω—è      | inventory_manager.py       | ‚≠ê           | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è     |
| 18  | Inline —Ä–µ–∂–∏–º + –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã               | P3        | 3-4 –¥–Ω—è    | inline_handler.py          | -           | ‚úÖ –ü–æ–ª–µ–∑–Ω–æ           |

**–û–±—â–∏–π —Å—Ä–æ–∫**: ~35 –¥–Ω–µ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, **20-25 –¥–Ω–µ–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ**

**–ù–æ–≤—ã–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (–Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞)**:

- ‚úÖ **#5**: Circuit Breaker Pattern - –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ API
- ‚úÖ **#6**: Database Connection Pooling - –≤–∞–∂–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ **#8**: Enhanced Monitoring (Grafana) - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫
- ‚úÖ **#9**: Security Hardening - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ security audits
- ‚úÖ **#10**: Load Testing - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–Ω–µ–¥—Ä–µ–Ω–∏—è - –û–ë–ù–û–í–õ–ï–ù–û

### Week 1: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (P1)

**–î–Ω–∏ 1-2**: Sentry Error Tracking (#2)
**–î–Ω–∏ 3-4**: Circuit Breaker Pattern (#5) ‚≠ê –ù–û–í–û–ï
**–î–Ω–∏ 5-6**: Database Connection Pooling (#6) ‚≠ê –ù–û–í–û–ï
**–î–Ω–∏ 7-8**: Simplified Batch Processing (#3)
**–î–Ω–∏ 9-11**: Auto-recovery & State Persistence (#1)
**–î–Ω–∏ 12-14**: API Schema Validation (#4)

### Week 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (P2)

**–î–µ–Ω—å 15**: Security Hardening (#9) ‚≠ê –ù–û–í–û–ï
**–î–Ω–∏ 16-17**: Enhanced Monitoring - Grafana (#8) ‚≠ê –ù–û–í–û–ï
**–î–Ω–∏ 18-20**: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–∞—Ä–≥–µ—Ç—ã (#14)
**–î–Ω–∏ 21-22**: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å (#7)
**–î–µ–Ω—å 23**: Cursor –ø–∞–≥–∏–Ω–∞—Ü–∏—è (#15)
**–î–Ω–∏ 24-25**: Resource Monitor (#16)

### Week 3: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (P2-P3)

**–î–Ω–∏ 26-28**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ–º (#17)
**–î–Ω–∏ 29-30**: Load & Stress Testing (#10) ‚≠ê –ù–û–í–û–ï
**–î–Ω–∏ 31-33**: WebSocket real-time (#11)
**–î–Ω–∏ 34-35**: Personal Watchlist (#13)

### Week 4: –§–∏–Ω–∞–ª—å–Ω—ã–µ —à—Ç—Ä–∏—Ö–∏ (P3)

**–î–µ–Ω—å 36**: Optimized Polling (#12)
**–î–Ω–∏ 37-40**: Inline —Ä–µ–∂–∏–º + –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (#18)

**–û–±—â–∞—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 40 –¥–Ω–µ–π (6 –Ω–µ–¥–µ–ª—å) –ø—Ä–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ
**–£—Å–∫–æ—Ä–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç**: 25-30 –¥–Ω–µ–π –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

---

## üíª –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è (Single User)

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

**VPS/–°–µ—Ä–≤–µ—Ä**:

- CPU: 1 core (2 cores —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- RAM: 1 GB (2 GB —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- Disk: 5 GB SSD
- OS: Ubuntu 22.04 / Windows Server / –ª—é–±–æ–π —Å Docker

**–°–µ—Ç—å**:

- Stable internet (–Ω–µ –Ω—É–∂–µ–Ω –ø—É–±–ª–∏—á–Ω—ã–π IP –¥–ª—è polling —Ä–µ–∂–∏–º–∞)
- 100 MB/month –º–∏–Ω–∏–º—É–º (–¥–ª—è API calls –∏ Telegram)

**–ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ**:

- Python 3.10+
- PostgreSQL 14+ (–∏–ª–∏ SQLite –¥–ª—è –Ω–∞—á–∞–ª–∞)
- Docker + Docker Compose (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- Git

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

**Docker Compose**:

```yaml
version: '3.8'

services:
  bot:
    build: .
    restart: unless-stopped
    env_file: .env
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
    depends_on:
      - postgres
      - redis

  postgres:
    image: postgres:15-alpine
    restart: unless-stopped
    environment:
      POSTGRES_DB: dmarket_bot
      POSTGRES_USER: dmarketbot
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    restart: unless-stopped
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:
```

---

## üõ°Ô∏è ToS Compliance Checklist

### ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–æ (–∏—Å–ø–æ–ª—å–∑—É–µ–º)

- ‚úÖ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ DMarket API endpoints
- ‚úÖ HMAC-SHA256 authentication –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- ‚úÖ Rate limiting –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ª–∏–º–∏—Ç–æ–≤ (30 req/min)
- ‚úÖ Cursor-based –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- ‚úÖ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (priceFrom/To, exterior[], etc.)

### ‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ (–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º)

- ‚ùå Web scraping —á–µ—Ä–µ–∑ Selenium/Playwright
- ‚ùå Reverse-engineering –Ω–µ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö API
- ‚ùå DevTools network inspection –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚ùå TreeFilters —á–µ—Ä–µ–∑ reverse engineering
- ‚ùå Rate limit –æ–±—Ö–æ–¥ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏
- ‚ùå Fake user agents –∏–ª–∏ bot detection bypass

---

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ Uptime > 99.5% (max 3.6 —á–∞—Å–∞ –ø—Ä–æ—Å—Ç–æ—è/–º–µ—Å—è—Ü)
- ‚úÖ Auto-recovery < 5 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ crash
- ‚úÖ Zero data loss –ø—Ä–∏ restart

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ Scan 1000 –ø—Ä–µ–¥–º–µ—Ç–æ–≤ < 5 –º–∏–Ω—É—Ç
- ‚úÖ API response time < 2 —Å–µ–∫—É–Ω–¥—ã (95th percentile)
- ‚úÖ Memory usage < 512 MB (steady state)

### –ö–∞—á–µ—Å—Ç–≤–æ

- ‚úÖ Sentry errors < 10/–¥–µ–Ω—å
- ‚úÖ False positive –∞—Ä–±–∏—Ç—Ä–∞–∂–∞ < 5%
- ‚úÖ Test coverage > 80% –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥—É–ª–µ–π

---

## üîß Maintenance Plan

### –ï–∂–µ–¥–Ω–µ–≤–Ω–æ

- –ü—Ä–æ–≤–µ—Ä–∫–∞ Sentry –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ uptime (—á–µ—Ä–µ–∑ health check)

### –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ

- –û–±–∑–æ—Ä Sentry digest
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –Ω–∞ –∞–Ω–æ–º–∞–ª–∏–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### –ï–∂–µ–º–µ—Å—è—á–Ω–æ

- Backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö checkpoints (> 30 –¥–Ω–µ–π)
- –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

### Backup —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):

```bash
#!/bin/bash
# cron: 0 3 * * * (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00)

DATE=$(date +%Y%m%d)
docker exec postgres pg_dump -U dmarketbot dmarket_bot > backup_${DATE}.sql
find . -name "backup_*.sql" -mtime +30 -delete
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:

- .env —Ñ–∞–π–ª ‚Üí –∑–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –∏ —Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
- docker-compose.yml ‚Üí git repository

### Security best practices

- ‚úÖ API –∫–ª—é—á–∏ –≤ .env (NEVER –≤ –∫–æ–¥–µ)
- ‚úÖ PostgreSQL password —Å–∏–ª—å–Ω—ã–π (20+ —Å–∏–º–≤–æ–ª–æ–≤)
- ‚úÖ Sentry DSN –Ω–µ –ø—É–±–ª–∏—á–Ω—ã–π
- ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ 2FA –Ω–∞ –≤—Å–µ—Ö –∞–∫–∫–∞—É–Ω—Ç–∞—Ö (DMarket, Telegram, Sentry)

---

**–û–±–Ω–æ–≤–ª–µ–Ω–æ**: 20 –Ω–æ—è–±—Ä—è 2025 –≥.
**–°—Ç–∞—Ç—É—Å**: –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–¥ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (single user)
**–í–µ—Ä—Å–∏—è**: 3.0 - –î–æ–±–∞–≤–ª–µ–Ω—ã —É–ª—É—á—à–µ–Ω–∏—è –∏–∑ external analysis (Circuit Breaker, DB Pooling, Monitoring, Security)
**Compliance**: ‚úÖ –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ DMarket ToS
**–ù–æ–≤—ã–µ –∑–∞–¥–∞—á–∏**: +5 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

## üìù Changelog –≤–µ—Ä—Å–∏–π

### v3.0 (20 –Ω–æ—è–±—Ä—è 2025) - External Analysis Integration

**–î–æ–±–∞–≤–ª–µ–Ω–æ**:

- ‚úÖ Circuit Breaker Pattern (P1) - –∑–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤ API
- ‚úÖ Database Connection Pooling (P1) - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î, –∏–Ω–¥–µ–∫—Å—ã
- ‚úÖ Enhanced Monitoring —Å Grafana (P2) - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫
- ‚úÖ Security Hardening (P2) - Bandit, Safety, Trivy audits
- ‚úÖ Load & Stress Testing (P3) - Locust –¥–ª—è performance testing

**–ò–∑–º–µ–Ω–µ–Ω–æ**:

- –ü–æ–≤—ã—à–µ–Ω –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç Circuit Breaker –∏ DB Pooling –¥–æ P1
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ roadmap: 40 –¥–Ω–µ–π –≤–º–µ—Å—Ç–æ 30
- –†–∞—Å—à–∏—Ä–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤: 18 –∑–∞–¥–∞—á –≤–º–µ—Å—Ç–æ 13

**–ò—Ç–æ–≥–æ**: 5 –Ω–æ–≤—ã—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π –¥–ª—è enterprise-level –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

### v2.0 (20 –Ω–æ—è–±—Ä—è 2025) - ToS Compliance Update

**–î–æ–±–∞–≤–ª–µ–Ω–æ**:

- –í—Å–µ –ø–æ–ª–µ–∑–Ω—ã–µ –∏–¥–µ–∏ –∏–∑ UPDATE_PLAN.md –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è ToS
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏, WebSocket, Resource Monitor

### v1.0 (20 –Ω–æ—è–±—Ä—è 2025) - Initial Personal Plan

**–°–æ–∑–¥–∞–Ω–æ**:

- –ë–∞–∑–æ–≤—ã–π –ø–ª–∞–Ω –¥–ª—è single-user —Ä–µ–∂–∏–º–∞
- –§–∞–∑–∞ 1 (P1): Auto-recovery, Sentry, Batch Processing, Schema Validation

---
