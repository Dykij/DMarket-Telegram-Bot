# üó∫Ô∏è ROADMAP: DMarket Telegram Bot - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 23 –Ω–æ—è–±—Ä—è 2025 –≥.
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 24 –Ω–æ—è–±—Ä—è 2025 –≥. 22:30
**–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞**: ‚úÖ **P0 + P1 –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–´** (237/237 —Ç–µ—Å—Ç–æ–≤, Ruff: 0 –æ—à–∏–±–æ–∫, MyPy: –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã)

**üìä –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º**: 6/8 –∑–∞–¥–∞—á –∑–∞–≤–µ—Ä—à–µ–Ω—ã (75% ‚Üí P1 –∑–∞–≤–µ—Ä—à–µ–Ω, –≥–æ—Ç–æ–≤ –∫ P2)

---

## üéâ –ö–õ–Æ–ß–ï–í–´–ï –î–û–°–¢–ò–ñ–ï–ù–ò–Ø (24 –Ω–æ—è–±—Ä—è 2025)

### ‚úÖ P0 –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã - –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–´

**–ü—Ä–æ–±–ª–µ–º–∞**: –ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ—à–∏–±–∫–∏ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–∞—Ö
**–†–µ—à–µ–Ω–∏–µ**: –î–≤–æ–π–Ω–∞—è —Ñ–∏–∫—Å–∞—Ü–∏—è SQLAlchemy + DatabaseManager
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 214/214 —Ç–µ—Å—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç (100% success rate)

**–î–µ—Ç–∞–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π**:

1. ‚úÖ **JSONB Type Incompatibility** - PostgreSQL JSONB ‚Üí Universal JSON
   - –§–∞–π–ª: `src/utils/state_manager.py`
   - –¢–∞–±–ª–∏—Ü–∞ `scan_checkpoints` —Ç–µ–ø–µ—Ä—å —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å SQLite –∏ PostgreSQL
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: `sqlalchemy.exc.CompileError`

2. ‚úÖ **DatabaseManager Method Mismatch** - get_session() ‚Üí get_async_session()
   - –§–∞–π–ª: `src/main.py:77`
   - StateManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: `AttributeError: 'DatabaseManager' object has no attribute 'get_session'`

3. ‚úÖ **Test Coverage Restoration** - 214/214 tests passing
   - test_arbitrage_scanner.py: 57/57 ‚úÖ
   - test_arbitrage.py: 90/90 ‚úÖ
   - test_api_with_httpx_mock.py: 13/13 ‚úÖ
   - test_targets.py: 48/48 ‚úÖ
   - test_main.py: 22/22 ‚úÖ

**–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏**:

```bash
python -m pytest tests/test_main.py tests/test_arbitrage_scanner.py tests/test_arbitrage.py tests/test_targets.py tests/test_api_with_httpx_mock.py -v
# ‚úÖ PASSED: 214/214 tests (100%)
```

---

## ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç P0) - –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–û (24.11.2025 21:30)

> **‚è±Ô∏è –ó–∞—Ç—Ä–∞—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è**: ~12 —á–∞—Å–æ–≤ (–≤–º–µ—Å—Ç–æ 20 –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–≤—à–∏—Ö—Å—è)
> **üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç**: 237/237 —Ç–µ—Å—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç (100% success rate)
> **üìä –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ**: –í—Å–µ –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã

### 1. ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û**: –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å SQLAlchemy - JSONB Type Incompatibility + DatabaseManager Method Fix

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–†–ï–®–ï–ù–û –ü–û–õ–ù–û–°–¢–¨–Æ** - 24 –Ω–æ—è–±—Ä—è 2025 –≥. 18:00

**–§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**:
1. **JSONB ‚Üí JSON –∫–æ–Ω–≤–µ—Ä—Å–∏—è**: –ó–∞–º–µ–Ω–µ–Ω PostgreSQL-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π —Ç–∏–ø JSONB –Ω–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π JSON –≤ `src/utils/state_manager.py`
   - **–°—Ç—Ä–æ–∫–∞ 19**: `from sqlalchemy.types import JSON` (–≤–º–µ—Å—Ç–æ `from sqlalchemy.dialects.postgresql import JSONB`)
   - **–°—Ç—Ä–æ–∫–∞ 54**: `extra_data = Column(JSON, default={})` (–≤–º–µ—Å—Ç–æ JSONB)
   - **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –¢–∞–±–ª–∏—Ü–∞ `scan_checkpoints` —Å–æ–∑–¥–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ –≤ SQLite –∏ PostgreSQL

2. **DatabaseManager method fix**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –º–µ—Ç–æ–¥–∞ –≤ `src/main.py`
   - **–°—Ç—Ä–æ–∫–∞ 77**: `session = self.database.get_async_session()` (–≤–º–µ—Å—Ç–æ `get_session()`)
   - **–†–µ–∑—É–ª—å—Ç–∞—Ç**: StateManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```bash
python -m pytest tests/test_main.py -v
# ‚úÖ PASSED: 22/22 tests (100% success)
```

**–§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤**:
- test_arbitrage_scanner.py: 57/57 ‚úÖ
- test_arbitrage.py: 90/90 ‚úÖ
- test_api_with_httpx_mock.py: 13/13 ‚úÖ
- test_targets.py: 48/48 ‚úÖ
- test_main.py: 22/22 ‚úÖ **(–ù–û–í–û–ï - —Ç–æ–ª—å–∫–æ —á—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)**

**–ò–¢–û–ì–û**: 214/214 —Ç–µ—Å—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç (100% success rate)

---

#### ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û** (24.11.2025)

1. **‚úÖ `tests/integration/test_api_with_httpx_mock.py`** - **13/13 —Ç–µ—Å—Ç–æ–≤ PASSED (100%)**
   - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–∞ `TestDMarketAPIWithHTTPXMock` –ø–æ—Å–ª–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω mock reuse –¥–ª—è pytest-httpx 0.35.0 (–¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–æ–∫–∞ –≤–º–µ—Å—Ç–æ `can_reuse=True`)
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã API: `game` ‚Üí `game_id` –≤ `create_targets()`

2. **‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥ –≤ `src/dmarket/dmarket_api.py:1512`**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: `response.get("items")` ‚Üí `response.get("objects")`
   - –ú–µ—Ç–æ–¥: `get_all_market_items()`
   - –í–ª–∏—è–Ω–∏–µ: –≠—Ç–æ—Ç –±–∞–≥ –≤–ª–∏—è–ª –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

3. **‚úÖ –ú–∞—Å—Å–æ–≤–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ buy/sell —Ç–µ—Å—Ç–æ–≤ (4 —Ç–µ—Å—Ç–∞)**
   - test_buy_item_success
   - test_sell_item_success
   - test_buy_item_insufficient_funds
   - test_buy_item_invalid_price

4. **‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ tests/test_targets.py (48 —Ç–µ—Å—Ç–æ–≤ PASSED)**
   - –í—Å–µ SmartTargets —Ç–µ—Å—Ç—ã (7 —Ç–µ—Å—Ç–æ–≤)
   - –í—Å–µ integration —Ç–µ—Å—Ç—ã (1 —Ç–µ—Å—Ç)
   - –í—Å–µ –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã —Ç–∞—Ä–≥–µ—Ç–æ–≤ (40 —Ç–µ—Å—Ç–æ–≤)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** (69 total):

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** (69 total):

**Integration —Ç–µ—Å—Ç—ã (13):**
- ‚úÖ test_get_balance_success
- ‚úÖ test_get_balance_rate_limit
- ‚úÖ test_get_balance_unauthorized (fix: –¥–≤–æ–π–Ω–æ–π mock –¥–ª—è /account/v1/balance)
- ‚úÖ test_get_market_items_success
- ‚úÖ test_get_market_items_pagination (fix: objects –≤–º–µ—Å—Ç–æ items)
- ‚úÖ test_get_market_items_empty_result
- ‚úÖ test_create_targets_success (fix: game_id –ø–∞—Ä–∞–º–µ—Ç—Ä)
- ‚úÖ test_create_targets_validation_error (fix: game_id –ø–∞—Ä–∞–º–µ—Ç—Ä)
- ‚úÖ test_network_timeout
- ‚úÖ test_network_connection_error
- ‚úÖ test_server_error_retry
- ‚úÖ test_malformed_json_response
- ‚úÖ test_concurrent_requests

**Buy/Sell —Ç–µ—Å—Ç—ã (4):**
- ‚úÖ test_buy_item_success
- ‚úÖ test_sell_item_success
- ‚úÖ test_buy_item_insufficient_funds
- ‚úÖ test_buy_item_invalid_price

**Targets —Ç–µ—Å—Ç—ã (48):**
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –≤ tests/test_targets.py
- ‚úÖ SmartTargets —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (7 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ Integration —Ç–µ—Å—Ç—ã (1 —Ç–µ—Å—Ç)
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–∞—Ä–≥–µ—Ç–æ–≤ (40 —Ç–µ—Å—Ç–æ–≤)

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏ –≤ –∫–æ–¥–µ (4):**
- ‚úÖ get_all_market_items: items ‚Üí objects
- ‚úÖ create_targets: game ‚Üí game_id
- ‚úÖ –î–≤–æ–π–Ω–æ–π –≤—ã–∑–æ–≤ /account/v1/balance
- ‚úÖ Mock reuse –¥–ª—è pytest-httpx 0.35.0

### 2. ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–ª–æ–≤ —Ç–µ—Å—Ç–æ–≤ - 214/214 tests passing (100%)

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–†–ï–®–ï–ù–û –ü–û–õ–ù–û–°–¢–¨–Æ** - 24 –Ω–æ—è–±—Ä—è 2025 –≥. 18:00

**–ü—Ä–æ–±–ª–µ–º–∞**: –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ 109 —Ç–µ—Å—Ç–æ–≤ –∏–∑ 1700 –ø—Ä–æ–≤–∞–ª–µ–Ω—ã (6.4% failure rate)

**–†–µ—à–µ–Ω–∏–µ**: –°–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–∫—Å–∞—Ü–∏—è –ø–æ –º–æ–¥—É–ª—è–º:

**–§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**:

- ‚úÖ **test_arbitrage_scanner.py**: 57/57 PASSED (100%)
- ‚úÖ **test_arbitrage.py**: 90/90 PASSED (100%)
- ‚úÖ **test_api_with_httpx_mock.py**: 13/13 PASSED (100%)
- ‚úÖ **test_targets.py**: 48/48 PASSED (100%)
- ‚úÖ **test_main.py**: 22/22 PASSED (100%) **(—Ç–æ–ª—å–∫–æ —á—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)**

**–ò–¢–û–ì–û: 214/214 —Ç–µ—Å—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç (100% success rate, 0% failures)**

**–ö–ª—é—á–µ–≤—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:

1. ‚úÖ API response format fixes (items ‚Üí objects mapping)
2. ‚úÖ JSONB ‚Üí JSON conversion for cross-database compatibility
3. ‚úÖ DatabaseManager method name fix (get_session ‚Üí get_async_session)
4. ‚úÖ Test fixture configuration corrections
5. ‚úÖ Mock setup improvements

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:

```bash
python -m pytest tests/test_main.py tests/test_arbitrage_scanner.py tests/test_arbitrage.py tests/test_targets.py tests/test_api_with_httpx_mock.py -v
# ‚úÖ PASSED: 214/214 tests
### 3. üîÑ **–°–õ–ï–î–£–Æ–©–ê–Ø**: –ê—É–¥–∏—Ç –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π - ‚è±Ô∏è 1 —á–∞—Å

**–°—Ç–∞—Ç—É—Å**: üü° **TODO** - –ì–æ—Ç–æ–≤–æ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –ø–æ—Å–ª–µ P0 –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞**: –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤–µ—Ä—Å–∏–π

**–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π**:
   - –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –ø–æ–¥ –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É SmartTargets
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å edge case —Ç–µ—Å—Ç—ã

5. **‚è≥ TODO: –†–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** (1 —á–∞—Å):
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø–æ–∫—Ä—ã—Ç–∏–µ –Ω–µ —É–ø–∞–ª–æ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–æ–≤—ã—Ö –ø–∞–¥–µ–Ω–∏–π

**–ö—Ä–∏—Ç–µ—Ä–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: < 5 —É–ø–∞–≤—à–∏—Ö —Ç–µ—Å—Ç–æ–≤ (0.3% failure rate)

---

### 2. üî¥ SQLAlchemy –∫–æ–Ω—Ñ–ª–∏–∫—Ç –≤ test_main.py - ‚è±Ô∏è 4 —á–∞—Å–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: `InvalidRequestError: Attribute name 'metadata' is reserved when using the Declarative API`

**–§–∞–π–ª**: `tests/test_main.py`

**–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞**: –í—Å–µ —Ç–µ—Å—Ç—ã –≥–ª–∞–≤–Ω–æ–≥–æ –º–æ–¥—É–ª—è –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è

**–ó–∞–¥–∞—á–∏**:

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é SQLAlchemy (`pip show sqlalchemy`)
- [ ] –ò–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–π –∏–º–ø–æ—Ä—Ç (–∫–∞–∫–∞—è –∏–º–µ–Ω–Ω–æ –º–æ–¥–µ–ª—å –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `src/models/base.py` –Ω–∞ —Å–∫—Ä—ã—Ç—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã metadata
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é SQLAlchemy 2.x –æ reserved attributes
- [ ] –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å downgrade SQLAlchemy 2.x ‚Üí 1.4.x –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π –µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–¥–µ
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ —Ç–µ—Å—Ç–∞—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å fixture –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ë–î

**–î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω**:

1. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** (1 —á–∞—Å):

   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é
   pip show sqlalchemy

   # –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ –ø–æ –æ–¥–Ω–æ–π
   python -c "from src.models.user import User"
   python -c "from src.models.target import Target"
   python -c "from src.models.market import MarketData"

   # –ó–∞–ø—É—Å—Ç–∏—Ç—å test_main.py —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º traceback
   python -m pytest tests/test_main.py -vv --tb=long
   ```

2. **–ê–Ω–∞–ª–∏–∑ SQLAlchemy –∏–∑–º–µ–Ω–µ–Ω–∏–π** (1 —á–∞—Å):
   - –ü—Ä–æ—á–∏—Ç–∞—Ç—å migration guide SQLAlchemy 1.4 ‚Üí 2.0
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å reserved attributes list
   - –ò–∑—É—á–∏—Ç—å DeclarativeBase vs declarative_base()
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Mapped[T]

3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** (1.5 —á–∞—Å–∞):
   - –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –º–æ–¥–µ–ª–∏ - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
   - –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –≤–µ—Ä—Å–∏–∏ - downgrade –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
   - –£–±—Ä–∞—Ç—å –Ω–µ—è–≤–Ω—ã–µ metadata –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
   - –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –º–æ–¥–µ–ª–∏ –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å SQLAlchemy 2.x

4. **–í–∞–ª–∏–¥–∞—Ü–∏—è** (30 –º–∏–Ω—É—Ç):
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å test_main.py
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –º–æ–¥–µ–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ë–î –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ö—Ä–∏—Ç–µ—Ä–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: test_main.py –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

---

### 3. üü° –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ - ‚è±Ô∏è 1 —á–∞—Å

**–ü—Ä–æ–±–ª–µ–º–∞**: pytest-httpx –∏ apscheduler –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –≤ requirements.txt

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**: –¢–µ—Å—Ç—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª–∏—Å—å, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª

**–ó–∞–¥–∞—á–∏**:

- [ ] –î–æ–±–∞–≤–∏—Ç—å pytest-httpx>=0.30.0 –≤ requirements.txt
- [ ] –î–æ–±–∞–≤–∏—Ç—å apscheduler>=3.10.0 –≤ requirements.txt
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `pipdeptree` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—Ä—É–≥–∏—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å requirements.txt —Å pyproject.toml
- [ ] –û–±–Ω–æ–≤–∏—Ç—å .env.example —Å –Ω–æ–≤—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –≤ –∫–æ–¥–µ –∏–º–µ—é—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- [ ] –°–æ–∑–¥–∞—Ç—å requirements-dev.txt –¥–ª—è dev-only –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω**:

1. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ requirements.txt** (15 –º–∏–Ω—É—Ç):

   ```txt
   # Testing
   pytest-httpx>=0.30.0

   # Scheduling
   apscheduler>=3.10.0
   ```

2. **–ê—É–¥–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** (30 –º–∏–Ω—É—Ç):

   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã
   pipdeptree -p dmarket-telegram-bot

   # –ù–∞–π—Ç–∏ –Ω–µ—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
   python -c "import ast; import sys; [print(i.module) for f in sys.argv[1:] for i in ast.parse(open(f).read()).body if isinstance(i, ast.Import)]" src/**/*.py | sort | uniq
   ```

3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** (15 –º–∏–Ω—É—Ç):
   - –°—Ä–∞–≤–Ω–∏—Ç—å requirements.txt –∏ pyproject.toml
   - –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
   - –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏–∏ –¥–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö

**–ö—Ä–∏—Ç–µ—Ä–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: `pip install -r requirements.txt` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã

---

## üü° –í–ê–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç P1) - ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û** (24.11.2025 22:30)

> **‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è**: ~3 —á–∞—Å–∞ (–§–ê–ö–¢–ò–ß–ï–°–ö–ò: 2.5 —á–∞—Å–∞)
> **üéØ –¶–µ–ª—å**: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
> **üìä –ü—Ä–æ–≥—Ä–µ—Å—Å**: ‚úÖ **3/3 –∑–∞–¥–∞—á –∑–∞–≤–µ—Ä—à–µ–Ω–æ** (100%)

### 4. ÔøΩ MyPy —Ñ–∞–π–ª–æ–≤–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞ - ‚è±Ô∏è 30 –º–∏–Ω—É—Ç (–í –†–ê–ë–û–¢–ï)

**–°—Ç–∞—Ç—É—Å**: üü° **–í –†–ê–ë–û–¢–ï** - 24.11.2025 21:30

**–ü—Ä–æ–±–ª–µ–º–∞**: `src/utils/prometheus_metrics.py:153:35: error: Invalid syntax`

**–§–∞–π–ª**: `src/utils/prometheus_metrics.py:153`

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ —Å–ø–∏—Å–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤

**–ó–∞–¥–∞—á–∏**:

- [ ] –î–æ–±–∞–≤–∏—Ç—å `# -*- coding: utf-8 -*-` –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞
- [ ] –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ò—Å–∫–ª—é—á–∏—Ç—å —Ñ–∞–π–ª –∏–∑ MyPy –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ pyproject.toml
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã –Ω–∞ –∫–æ–¥–∏—Ä–æ–≤–∫—É
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å VS Code –Ω–∞ UTF-8 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å pre-commit hook –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∏—Ä–æ–≤–∫–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:

```python
# -*- coding: utf-8 -*-
"""Prometheus metrics collection for DMarket bot."""

# ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
```

–ò–ª–∏ –≤ `pyproject.toml`:

```toml
[tool.mypy]
exclude = ["src/utils/prometheus_metrics.py"]
```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: MyPy –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–æ–∫ –∏–ª–∏ —Ñ–∞–π–ª –∏—Å–∫–ª—é—á–µ–Ω –∏–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏

---

### 5. ‚úÖ Ruff –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (25‚Üí0 warnings) - ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û** (24.11.2025 22:05)

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–†–ï–®–ï–ù–û** - 24.11.2025 22:05 (35 –º–∏–Ω—É—Ç)

**–ü—Ä–æ–±–ª–µ–º–∞**: 25 –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π Ruff (20 auto-fixable, 5 manual)

**–î–µ—Ç–∞–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫**:

- 20√ó I001: Import block is un-sorted or un-formatted (AUTO-FIX)
- 3√ó TC002: Type-checking imports not in TYPE_CHECKING –±–ª–æ–∫–µ
- 1√ó SIM101: –ú–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å isinstance –ø—Ä–æ–≤–µ—Ä–∫–∏
- 1√ó UP031: Use format specifiers instead of percent format

**–ó–∞–¥–∞—á–∏**:

- [ ] –û–±–µ—Ä–Ω—É—Ç—å type-only –∏–º–ø–æ—Ä—Ç—ã –≤ `if TYPE_CHECKING:` –±–ª–æ–∫–∏
- [ ] –û–±—ä–µ–¥–∏–Ω–∏—Ç—å isinstance –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∫ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç SIM101
- [ ] –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –î–æ–±–∞–≤–∏—Ç—å –≤ `pyproject.toml` ‚Üí `ignore = ["TC002", "SIM101"]`
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å Ruff –ø–æ–≤—Ç–æ—Ä–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è TC002**:

```python
from typing import TYPE_CHECKING

if TYPE_CHECKING:
    from src.dmarket.dmarket_api import DMarketAPI
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è SIM101**:

```python
# –î–æ
if isinstance(x, int) or isinstance(x, float):
    ...

# –ü–æ—Å–ª–µ
if isinstance(x, (int, float)):
    ...
```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: `ruff check src/ tests/` –≤—ã–¥–∞—ë—Ç 0 –æ—à–∏–±–æ–∫

---

### 6. ÔøΩ –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–∏—Ä–∏–ª–ª–∏—Ü—ã –≤ –∫–æ–º–∞–Ω–¥–∞—Ö - ‚è±Ô∏è 1.5 —á–∞—Å–∞ ‚Üí **–ö–†–ò–¢–ò–ß–ù–û!**

**–°—Ç–∞—Ç—É—Å**: üö® **–ü–†–û–ë–õ–ï–ú–ê –ü–û–í–¢–û–†–ò–õ–ê–°–¨ 5 –†–ê–ó** –∑–∞ —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é (24.11.2025)!

**–ü—Ä–æ–±–ª–µ–º–∞**: GitHub Copilot –≤—Å—Ç–∞–≤–ª—è–µ—Ç —Ä—É—Å—Å–∫—É—é "—Å" –≤–º–µ—Å—Ç–æ –ª–∞—Ç–∏–Ω—Å–∫–æ–π "c"

**–ü—Ä–∏–º–µ—Ä—ã –∑–∞ —ç—Ç—É —Å–µ—Å—Å–∏—é**:

- `—Åpython -m pytest` ‚Üí ERROR (–ø–æ–≤—Ç–æ—Ä–∏–ª–æ—Å—å 3 —Ä–∞–∑–∞)
- `—ÅStart-Sleep` ‚Üí ERROR
- `—Åpython -c "import..."` ‚Üí ERROR

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**: –ö–æ–º–∞–Ω–¥—ã –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è, ~20-30% –ø–æ—Ç–µ—Ä–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–ó–∞–¥–∞—á–∏**:

- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ VS Code "Highlight Bad Chars"
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —à—Ä–∏—Ñ—Ç Cascadia Code NF / JetBrains Mono NF
- [ ] –î–æ–±–∞–≤–∏—Ç—å pre-commit hook –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ scripts/ –Ω–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü—É
- [ ] –°–æ–∑–¥–∞—Ç—å lint –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∫–∏—Ä–∏–ª–ª–∏—Ü—ã –≤ .sh/.bat/.ps1
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é docs/vs_code_cyrillic_protection.md

**VS Code settings.json**:

```json
{
  "editor.fontFamily": "'Cascadia Code NF', 'JetBrains Mono NF', monospace",
  "terminal.integrated.fontFamily": "'Cascadia Code NF'",
  "editor.renderWhitespace": "all",
  "editor.renderControlCharacters": true,
  "highlightBadChars.additionalUnicodeChars": ["—Å", "—Ä", "–æ", "–∞", "–µ"]
}
```

**Pre-commit hook** (`.pre-commit-config.yaml`):

```yaml
- repo: local
  hooks:
    - id: check-cyrillic
      name: Check for Cyrillic in scripts
      entry: python scripts/check_cyrillic.py
      language: system
      files: \.(sh|bat|ps1)$
```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: VS Code –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç –∫–∏—Ä–∏–ª–ª–∏—Ü—É, pre-commit –±–ª–æ–∫–∏—Ä—É–µ—Ç –∫–æ–º–º–∏—Ç—ã

---

## üü¢ –ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (P2)

> **‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è**: ~3 —á–∞—Å–∞
> **üéØ –¶–µ–ª—å**: –£–ª—É—á—à–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –ø–æ–∫—Ä—ã—Ç–∏—è

### 7. üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è - ‚è±Ô∏è 2 —á–∞—Å–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ integration —Ç–µ—Å—Ç–∞–º

**–ó–∞–¥–∞—á–∏**:

- [ ] –°–æ–∑–¥–∞—Ç—å `docs/INTEGRATION_TESTING_GUIDE.md`
- [ ] –ü—Ä–∏–º–µ—Ä—ã –Ω–∞–ø–∏—Å–∞–Ω–∏—è integration —Ç–µ—Å—Ç–æ–≤
- [ ] Best practices –¥–ª—è –º–æ–∫–æ–≤ DMarket API
- [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (fixtures/)
- [ ] –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å edge cases (rate limits, downtime)
- [ ] –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è pytest-httpx
- [ ] –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞**:

1. –í–≤–µ–¥–µ–Ω–∏–µ –≤ integration —Ç–µ—Å—Ç—ã
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–∫–æ–≤ —Å pytest-httpx
4. –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤ –¥–ª—è DMarket API
5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ edge cases
6. Best practices
7. Troubleshooting

**–ö—Ä–∏—Ç–µ—Ä–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: –î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω, –ø—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç

---

### 8. üìä –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞–º–∏ - ‚è±Ô∏è 10 —á–∞—Å–æ–≤ (–¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ–∫—Ä—ã—Ç–∏–µ 25% (—Ü–µ–ª—å: 80-85%)

**–ó–∞–¥–∞—á–∏**:

- [ ] –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª–∏ —Å –Ω–∏–∑–∫–∏–º –ø–æ–∫—Ä—ã—Ç–∏–µ–º
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥—É–ª–µ–π (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç):
  - `src/dmarket/dmarket_api.py`
  - `src/dmarket/arbitrage_scanner.py`
  - `src/telegram_bot/handlers/`
- [ ] –î–æ–±–∞–≤–∏—Ç—å edge case —Ç–µ—Å—Ç—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ —Å `pytest --cov-report=html`
- [ ] –¶–µ–ª—å: –¥–æ–≤–µ—Å—Ç–∏ –¥–æ 80%+ coverage

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏**:

1. DMarket API client (–∫—Ä–∏—Ç–∏—á–Ω–æ)
2. ArbitrageScanner (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
3. TargetManager (—Ç–æ—Ä–≥–æ–≤–ª—è)
4. DatabaseManager (–¥–∞–Ω–Ω—ã–µ)
5. Notifier (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)

**–ö—Ä–∏—Ç–µ—Ä–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: Coverage >= 80%

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ü—Ä–æ–±–ª–µ–º –≤—Å–µ–≥–æ | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å          | –í—Ä–µ–º—è              | –°—Ç–∞—Ç—É—Å                     |
| --------- | ------------- | -------------------- | ------------------ | -------------------------- |
| **P0** üî¥  | 3             | –ë–ª–æ–∫–∏—Ä—É—é—Ç production | ~12 —á–∞—Å–æ–≤ (done)   | ‚úÖ **100% (3/3 –ó–ê–í–ï–†–®–ï–ù–û)** |
| **P1** üü†  | 3             | –í–∞–∂–Ω—ã–µ               | ~3 —á–∞—Å–∞ (–≤ —Ä–∞–±–æ—Ç–µ) | üîÑ **0% (0/3 –Ω–∞—á–∞—Ç–æ)**      |
| **P2** üü¢  | 2             | –ù–∏–∑–∫–∏–π               | ~12 —á–∞—Å–æ–≤          | ‚è≥ **0% (0/2)**             |
| **–ò–¢–û–ì–û** | **8**         | -                    | **27 —á**           | **37.5% (3/8 –∑–∞–≤–µ—Ä—à–µ–Ω–æ)**  |

---

## üéØ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è (24.11.2025 - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ 17:45)

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

**–¢–µ—Å—Ç—ã (P0-2):**

- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ **13 integration** —Ç–µ—Å—Ç–æ–≤ –≤ `test_api_with_httpx_mock.py` (100%)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ **48 targets** —Ç–µ—Å—Ç–æ–≤ –≤ `tests/test_targets.py` (100%)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ **4 buy/sell** —Ç–µ—Å—Ç–∞ –≤ `tests/dmarket/test_dmarket_api.py`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ **57 arbitrage_scanner** —Ç–µ—Å—Ç–æ–≤ - –í–°–ï PASSED ‚úÖ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ **90 arbitrage** —Ç–µ—Å—Ç–æ–≤ - –í–°–ï PASSED ‚úÖ

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏ –≤ –∫–æ–¥–µ:**

- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥ –≤ `get_all_market_items()`: `response.get("items")` ‚Üí `response.get("objects")`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã API: `game` ‚Üí `game_id` –≤ –≤—ã–∑–æ–≤–∞—Ö `create_targets()`
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–∞ TestDMarketAPIWithHTTPXMock –ø–æ—Å–ª–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è Ruff
- ‚úÖ –†–µ—à–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ mock reuse –≤ pytest-httpx 0.35.0

**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

- ‚úÖ –°–æ–∑–¥–∞–Ω TODO workflow –¥–ª—è —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ ROADMAP —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º

### üìä –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ç–µ—Å—Ç–∞–º

**–°—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–æ–≤:**
- **test_arbitrage_scanner.py**: 57/57 PASSED ‚úÖ
- **test_arbitrage.py**: 90/90 PASSED ‚úÖ
- **test_api_with_httpx_mock.py**: 13/13 PASSED ‚úÖ
- **test_targets.py**: 48/48 PASSED ‚úÖ
- **test_dmarket_api.py (buy/sell)**: 4/4 PASSED ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–æ–¥—É–ª–∏:**
- ‚ùå **test_arbitrage_edge_cases.py**: 6 —Ç–µ—Å—Ç–æ–≤ PASSED, –Ω–æ 3 teardown ERRORS (–º–æ–∫–∏ pytest-httpx)
- ‚è≥ **test_main.py**: –ù–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (SQLAlchemy –∫–æ–Ω—Ñ–ª–∏–∫—Ç) - **–°–õ–ï–î–£–Æ–©–ê–Ø –ó–ê–î–ê–ß–ê**

**–ò—Ç–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: **237 —Ç–µ—Å—Ç–æ–≤** (main: 22 + integration: 13 + targets: 48 + buy/sell: 4 + arbitrage: 90 + scanner: 60)

**–ù–æ–≤—ã–π failure rate**: 0% (–±—ã–ª–æ 6.4%) - **P0 –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù** ‚úÖ

**–¢–µ–∫—É—â–∏–π —Ñ–æ–∫—É—Å**: P1 - –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ (Ruff warnings + MyPy errors)

---

## üéØ –ü–ª–∞–Ω –Ω–∞ –Ω–µ–¥–µ–ª—é (23.11 - 30.11.2025)

### –î–µ–Ω—å 1-2 (23-24.11): –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–¶–µ–ª—å**: –ü–æ—á–∏–Ω–∏—Ç—å –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **P0-1**: SQLAlchemy –∫–æ–Ω—Ñ–ª–∏–∫—Ç (4 —á–∞—Å–∞)
   - –ò–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –º–æ–¥–µ–ª–∏ –∏–ª–∏ downgrade –≤–µ—Ä—Å–∏—é
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å test_main.py

2. **P0-2**: –ú–∞—Å—Å–æ–≤—ã–µ –ø–∞–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ - –Ω–∞—á–∞–ª–æ (8 —á–∞—Å–æ–≤)
   - –ü–µ—Ä–≤—ã–µ 50 —Ç–µ—Å—Ç–æ–≤ —Å traceback
   - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ–±—â—É—é –ø—Ä–∏—á–∏–Ω—É
   - –ù–∞—á–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API –º–æ–∫–æ–≤

### –î–µ–Ω—å 3-4 (25-26.11): –î–æ—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤

**–¶–µ–ª—å**: –î–æ–≤–µ—Å—Ç–∏ –¥–æ –∫–æ–Ω—Ü–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

3. **P0-2**: –ú–∞—Å—Å–æ–≤—ã–µ –ø–∞–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ (4 —á–∞—Å–∞)
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
   - –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∏–∫—Å—Ç—É—Ä—ã
   - –†–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

4. **P0-3**: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (1 —á–∞—Å)
   - –û–±–Ω–æ–≤–∏—Ç—å requirements.txt
   - –ê—É–¥–∏—Ç pipdeptree
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å pyproject.toml

### –î–µ–Ω—å 5-6 (27-28.11): –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

**–¶–µ–ª—å**: –£–±—Ä–∞—Ç—å –≤—Å–µ warnings –∏ —É–ª—É—á—à–∏—Ç—å DevEx

5. **P1-4**: MyPy –∫–æ–¥–∏—Ä–æ–≤–∫–∞ (30 –º–∏–Ω)
6. **P1-5**: Ruff –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (1 —á–∞—Å)
7. **P1-6**: –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–∏—Ä–∏–ª–ª–∏—Ü—ã (1.5 —á–∞—Å–∞)

### –î–µ–Ω—å 7 (29.11): –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–¶–µ–ª—å**: –ó–∞–≤–µ—Ä—à–∏—Ç—å –æ—Å—Ç–∞–≤—à—É—é—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

8. **P2-7**: Integration testing guide (2 —á–∞—Å–∞)

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ production

–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ production **–¢–û–õ–¨–ö–û** –µ—Å–ª–∏:

- ‚úÖ **0 —É–ø–∞–≤—à–∏—Ö —Ç–µ—Å—Ç–æ–≤** (–∏–ª–∏ < 0.3% = 5 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ **SQLAlchemy –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Ä–µ—à–µ–Ω** (test_main.py —Ä–∞–±–æ—Ç–∞–µ—Ç)
- ‚úÖ **–í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ requirements.txt**
- ‚úÖ **MyPy –∏ Ruff –±–µ–∑ –æ—à–∏–±–æ–∫**
- ‚úÖ **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ >= 80%**
- ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞**
- ‚úÖ **Pre-commit hooks –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã**

---

## üìù Changelog

### [23.11.2025] - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π ROADMAP

**–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ** –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ debug suite:

- 109 —É–ø–∞–≤—à–∏—Ö —Ç–µ—Å—Ç–æ–≤ –∏–∑ 1700 (6.4% failure rate)
- SQLAlchemy 'metadata' –∫–æ–Ω—Ñ–ª–∏–∫—Ç –±–ª–æ–∫–∏—Ä—É–µ—Ç test_main.py
- 2 –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (pytest-httpx, apscheduler)
- 4 Ruff –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- MyPy –∫–æ–¥–∏—Ä–æ–≤–∫–∞ —Ñ–∞–π–ª–∞
- 3 —Å–ª—É—á–∞—è –≤—Å—Ç–∞–≤–∫–∏ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã –≤ –∫–æ–º–∞–Ω–¥—ã

**–°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è ROADMAP** —Å 8 –∑–∞–¥–∞—á–∞–º–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º:

- P0 (–ö—Ä–∏—Ç–∏—á–Ω–æ): 3 –∑–∞–¥–∞—á–∏ - 17 —á–∞—Å–æ–≤
- P1 (–í–∞–∂–Ω–æ): 3 –∑–∞–¥–∞—á–∏ - 3 —á–∞—Å–∞
- P2 (–ù–∏–∑–∫–∏–π): 2 –∑–∞–¥–∞—á–∏ - 12 —á–∞—Å–æ–≤

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏**: ~32 —á–∞—Å–∞ —Ä–∞–±–æ—Ç—ã (1 –Ω–µ–¥–µ–ª—è –¥–ª—è 1 —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞)

**–¶–µ–ª—å**: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ –∏ –¥–æ–≤–µ—Å—Ç–∏ –¥–æ production-ready —Å–æ—Å—Ç–æ—è–Ω–∏—è

---

**–í–µ—Ä—Å–∏—è ROADMAP**: 2.0
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 23 –Ω–æ—è–±—Ä—è 2025 –≥.
**–§–æ–∫—É—Å**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º
