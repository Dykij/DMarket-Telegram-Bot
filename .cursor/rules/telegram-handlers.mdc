---
description: "Telegram bot handler standards"
globs: ["src/telegram_bot/**/*.py"]
alwaysApply: true
---

# Telegram Bot Handler Rules

## Handler Structure
```python
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import ContextTypes

import structlog

logger = structlog.get_logger(__name__)

async def command_handler(
    update: Update,
    context: ContextTypes.DEFAULT_TYPE
) -> None:
    """Handle /command - brief description."""
    if not update.message:
        return
        
    user_id = update.effective_user.id
    logger.info("command_received", user_id=user_id, command="command")
    
    try:
        # Business logic here
        result = await some_async_operation()
        
        await update.message.reply_text(f"✅ Result: {result}")
        
    except Exception as e:
        logger.error("command_failed", user_id=user_id, error=str(e))
        await update.message.reply_text(
            "❌ An error occurred. Please try again later."
        )
```

## Requirements
- Use python-telegram-bot 22.0+ async API
- Type all parameters with Update and ContextTypes
- Add error handling with user-friendly messages
- Log all actions with structlog
- Use inline keyboards for navigation

## Callback Handlers
- Always call `await query.answer()` first
- Use `match/case` for routing callbacks
- Log unknown callbacks as warnings

## Localization
- Use localization module for all user-facing text
- Support at least: RU, EN
- Store translations in separate files
