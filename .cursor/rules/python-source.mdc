---
description: "Python async code standards for source files"
globs: ["src/**/*.py"]
alwaysApply: true
---

# Python Source Code Rules

## Async/Await Requirements
- Use `async def` for all I/O operations
- Use `await` for all async calls
- Use `asyncio.gather()` for parallel execution
- Use `httpx.AsyncClient` for HTTP requests

## Type Annotations
- Always annotate function parameters and return types
- Use Python 3.11+ syntax: `list[str]`, `dict[str, Any]`
- Use `|` for union types: `str | None`

## Error Handling
- Never use bare `except:`
- Catch specific exceptions
- Log errors with structlog context
- Re-raise or return meaningful messages

## Imports
- Use absolute imports
- Order: stdlib, third-party, local
- Sort alphabetically within groups

## Docstrings
- Use Google style docstrings
- Document Args, Returns, Raises
- Add examples for complex functions

## Logging
- Use `structlog.get_logger(__name__)`
- Include context: user_id, item_id, etc.
- Never log sensitive data

## Function Design
- Keep functions under 50 lines
- Maximum 3 levels of nesting
- Use early returns to reduce complexity
