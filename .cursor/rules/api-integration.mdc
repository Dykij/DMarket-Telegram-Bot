---
description: "DMarket and Waxpeer API integration rules"
globs: ["src/dmarket/**/*.py", "src/waxpeer/**/*.py"]
alwaysApply: true
---

# API Integration Rules

## DMarket API Specifics
- **Prices in CENTS**: 1000 = $10.00 USD
- **Commission**: 7% on sales
- **Rate limit**: 30 requests/minute
- **Auth**: HMAC-SHA256 signatures

```python
# Price conversion
price_usd = api_response["price"]["USD"] / 100  # cents to dollars
```

## Waxpeer API Specifics
- **Prices in MILS**: 1000 mils = $1.00 USD
- **Commission**: 6% on sales
- **Auth**: API key in header

```python
# Price conversion
price_usd = api_response["price"] / 1000  # mils to dollars
```

## Cross-Platform Arbitrage
```python
# DMarket â†’ Waxpeer arbitrage formula
net_profit = (waxpeer_price * 0.94) - dmarket_price
roi_percent = (net_profit / dmarket_price) * 100
```

## HTTP Client Requirements
- Use `httpx.AsyncClient` with timeout
- Implement retry with exponential backoff
- Handle rate limiting (429) gracefully
- Log all API errors with context

## Error Handling
- Catch `httpx.HTTPStatusError` for HTTP errors
- Catch `httpx.RequestError` for network issues
- Use tenacity for retries
- Implement circuit breaker for unstable APIs
