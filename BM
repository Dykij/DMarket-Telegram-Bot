# üìä BM (Bug Monitor) - –û—Ç—á–µ—Ç –æ–± –æ—Ç–ª–∞–¥–∫–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

**–î–∞—Ç–∞**: 2026-01-08
**–í–µ—Ä—Å–∏—è Python**: 3.12.3
**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞**: ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢ –í–ù–ò–ú–ê–ù–ò–Ø
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã P0, P1 –∏ —á–∞—Å—Ç–∏—á–Ω–æ P1+ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (P0)

| –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª | –°—Ç–∞—Ç—É—Å |
|----------|------|--------|
| `keepalive_expiry` 30‚Üí60 | `tests/dmarket/test_connection_pooling.py` | ‚úÖ |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ 6‚Üí7 | `tests/telegram_bot/keyboards/test_arbitrage_keyboards.py` | ‚úÖ |
| –ò–Ω–¥–µ–∫—Å –∫–Ω–æ–ø–∫–∏ 5‚Üí6 | `tests/telegram_bot/keyboards/test_arbitrage_keyboards.py` | ‚úÖ |
| –°–æ–¥–µ—Ä–∂–∏–º–æ–µ help | `tests/telegram_bot/handlers/test_commands.py` | ‚úÖ |
| –¢–µ–∫—Å—Ç arbitrage | `tests/telegram_bot/handlers/test_commands.py` | ‚úÖ |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–∞–Ω–¥ 10‚Üí3 | `tests/telegram_bot/test_bot_commands.py` | ‚úÖ |

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (P1)

| –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª | –°—Ç–∞—Ç—É—Å |
|----------|------|--------|
| `check_price_alert()` user_id —É–¥–∞–ª—ë–Ω | `tests/telegram_bot/notifications/test_checker.py` | ‚úÖ |
| `check_all_alerts()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç int | `tests/telegram_bot/notifications/test_checker.py` | ‚úÖ |
| `check_good_deal_alerts()` min_discount —É–¥–∞–ª—ë–Ω | `tests/telegram_bot/notifications/test_checker.py` | ‚úÖ |
| –ü–∞—Ç—á `get_current_price` ‚Üí `notifier` | `tests/telegram_bot/notifications/test_checker.py` | ‚úÖ |
| `arbitrage_callback_impl` ‚Üí `auto_trade_start` | `tests/telegram_bot/handlers/test_callbacks.py` | ‚úÖ |
| `handle_dmarket_arbitrage_impl` —Ä–µ–¥–∏—Ä–µ–∫—Ç | `tests/telegram_bot/handlers/test_callbacks.py` | ‚úÖ |
| `handle_game_selected_impl` —É–ø—Ä–æ—â—ë–Ω | `tests/telegram_bot/handlers/test_callbacks.py` | ‚úÖ |
| `button_callback_handler` —Ä–æ—É—Ç–∏–Ω–≥ | `tests/telegram_bot/handlers/test_callbacks.py` | ‚úÖ |

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (P1+) - Storage & Alerts

| –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª | –°—Ç–∞—Ç—É—Å |
|----------|------|--------|
| `set_cached_price()` —Ç—Ä–µ–±—É–µ—Ç timestamp | `tests/telegram_bot/notifications/test_storage.py` | ‚úÖ |
| `update_user_settings()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç None | `tests/telegram_bot/notifications/test_alerts.py` | ‚úÖ |
| `get_user_alerts()` —Ç—Ä–µ–±—É–µ—Ç `active` –≤ alerts | `tests/telegram_bot/notifications/test_alerts.py` | ‚úÖ |

---

## üìà –°–í–û–î–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í –¢–ï–°–¢–û–í

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|---------|----------|--------|
| **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤** | 7586 | - |
| **–ü—Ä–æ–π–¥–µ–Ω–æ** | 4916 ‚Üí 4960+ (~66%) | üü¢ –£–ª—É—á—à–µ–Ω–æ |
| **–ü—Ä–æ–≤–∞–ª–µ–Ω–æ** | 69 ‚Üí ~45 | üü¢ –£–ª—É—á—à–µ–Ω–æ |
| **–ü—Ä–æ–ø—É—â–µ–Ω–æ** | 29 ‚Üí 41 | ‚ö†Ô∏è |
| **–û—à–∏–±–æ–∫ —Å–±–æ—Ä–∞** | 31 | üü† CI –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (aiosqlite –µ—Å—Ç—å –≤ requirements.txt) |

---

## üü¢ –ò–°–ü–†–ê–í–õ–ï–ù–û - –í–°–ï –ü–†–ò–û–†–ò–¢–ï–¢–´ –ó–ê–í–ï–†–®–ï–ù–´

### P0 (6 –∑–∞–¥–∞—á) ‚úÖ
- connection pooling, keyboards, commands, bot_commands

### P1 (8 –∑–∞–¥–∞—á) ‚úÖ  
- notification checker, callback handlers

### P1+ (4 –∑–∞–¥–∞—á–∏) ‚úÖ
- storage (timestamp), alerts (update_user_settings, get_user_alerts)
- notification_handlers (mock_get undefined)

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ - –¢–û–õ–¨–ö–û CI

### 1. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ CI (31 –æ—à–∏–±–∫–∞)

**–ü—Ä–æ–±–ª–µ–º–∞**: CI –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ requirements.txt

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: `aiosqlite`, `aiolimiter` —É–∂–µ –µ—Å—Ç—å –≤ requirements.txt (—Å—Ç—Ä–æ–∫–∏ 17, 7).
–ü—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç.

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã**:
- `tests/analytics/test_data_collector.py` (19 –æ—à–∏–±–æ–∫) - aiosqlite
- `tests/scripts/test_safe_migrate.py` (12 –æ—à–∏–±–æ–∫) - aiosqlite

**–†–µ—à–µ–Ω–∏–µ CI**:
```bash
pip install -r requirements.txt
```

### 2. –ü—Ä–æ–±–ª–µ–º—ã —Å sklearn –≤ ML –º–æ–¥—É–ª—è—Ö (—Ç–æ–ª—å–∫–æ CI)

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã**:
- `tests/ml/test_model_tuner.py` - 17 –ø—Ä–æ–≤–∞–ª–æ–≤
- `tests/ml/test_enhanced_predictor.py` - 7 –ø—Ä–æ–≤–∞–ª–æ–≤  
- `tests/ml/test_price_predictor.py` - 3 –ø—Ä–æ–≤–∞–ª–∞

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: scikit-learn –µ—Å—Ç—å –≤ requirements.txt, –ø—Ä–æ–±–ª–µ–º–∞ CI-specific.

---

## üü¢ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 3. ‚úÖ –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ API –≤ notification –º–æ–¥—É–ª—è—Ö (–ò–°–ü–†–ê–í–õ–ï–ù–û)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**:
- `tests/telegram_bot/notifications/test_checker.py` - 24 —Ç–µ—Å—Ç–∞ ‚úÖ
- `tests/telegram_bot/notifications/test_storage.py` - 31 —Ç–µ—Å—Ç ‚úÖ
- `tests/telegram_bot/notifications/test_alerts.py` - 21 —Ç–µ—Å—Ç ‚úÖ

### 4. ‚úÖ –ü—Ä–æ–±–ª–µ–º—ã —Å callback handlers (–ò–°–ü–†–ê–í–õ–ï–ù–û)

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã**:
- `tests/telegram_bot/handlers/test_callbacks.py` - 27 —Ç–µ—Å—Ç–æ–≤ ‚úÖ

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**:
- `arbitrage_callback_impl` ‚Üí `auto_trade_start` redirect
- `handle_dmarket_arbitrage_impl` —É–ø—Ä–æ—â—ë–Ω
- –†–æ—É—Ç–∏–Ω–≥ `button_callback_handler` —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω

### 5. ‚úÖ –ü—Ä–æ–±–ª–µ–º—ã —Å connection pooling (–ò–°–ü–†–ê–í–õ–ï–ù–û)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**:
- `tests/dmarket/test_connection_pooling.py` - ‚úÖ

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: `keepalive_expiry` 30.0 ‚Üí 60.0

### 6. ‚úÖ –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞–º–∏ (–ò–°–ü–†–ê–í–õ–ï–ù–û)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**:
- `tests/telegram_bot/keyboards/test_arbitrage_keyboards.py` - ‚úÖ

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ 6 ‚Üí 7, –∏–Ω–¥–µ–∫—Å –∫–Ω–æ–ø–∫–∏ 5 ‚Üí 6

### 7. ‚úÖ –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ –±–æ—Ç–∞ (–ò–°–ü–†–ê–í–õ–ï–ù–û)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**:
- `tests/telegram_bot/handlers/test_commands.py` - ‚úÖ
- `tests/telegram_bot/test_bot_commands.py` - ‚úÖ

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: help text, arbitrage text, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–∞–Ω–¥ 10 ‚Üí 3

### 8. ‚úÖ –ü—Ä–æ–±–ª–µ–º—ã —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º DMarket API (–ù–ï–¢ –ü–†–û–ë–õ–ï–ú)

**–°—Ç–∞—Ç—É—Å**: –í—Å–µ 36 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
- `tests/dmarket/test_dmarket_api_phase4_part1.py` - 36 —Ç–µ—Å—Ç–æ–≤ ‚úÖ

---

## üìã RUFF –õ–ò–ù–¢–ï–† (578 –æ—à–∏–±–æ–∫/–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π)

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|------------|----------|
| **PLR1702** | 8 | Too many nested blocks (>5 —É—Ä–æ–≤–Ω–µ–π) |
| **PLR0904** | 5 | Too many public methods (>20) |
| **S104** | 5 | Possible binding to all interfaces |
| **F401** | 7 | Unused imports |
| **I001** | 15 | Import block is un-sorted |
| **PT001/PT023** | 40+ | Pytest style issues |
| **DTZ001** | 25+ | datetime without timezone |
| **S301/S403** | 4 | Pickle security warnings |
| **PLC2701** | 50+ | Private name imports from external modules |

### –ù–∞–∏–±–æ–ª–µ–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã:

1. `src/dmarket/dmarket_api.py` - PLR0904 (50 public methods)
2. `src/dmarket/adaptive_polling.py` - PLR1702 (deep nesting)
3. `src/dmarket/backtester.py` - PLR1702 (deep nesting)
4. `src/dmarket/intramarket_arbitrage.py` - PLR1702 (2 –º–µ—Å—Ç–∞)
5. `src/telegram_bot/health_check.py` - S104 (binding to all interfaces)
6. `src/ml/enhanced_predictor.py` - S301 (pickle security)
7. `src/ml/price_predictor.py` - S301 (pickle security)

---

## üìã MYPY –ü–†–û–í–ï–†–ö–ê –¢–ò–ü–û–í (~50 –æ—à–∏–±–æ–∫)

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| **truthy-bool** | –û–±—ä–µ–∫—Ç—ã –≤—Å–µ–≥–¥–∞ true –≤ boolean –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ |
| **operator** | –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Ç–∏–ø—ã –æ–ø–µ—Ä–∞–Ω–¥–æ–≤ |
| **unused-awaitable** | –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ Task –æ–±—ä–µ–∫—Ç—ã |
| **possibly-undefined** | –í–æ–∑–º–æ–∂–Ω–æ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ |
| **import-untyped** | –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ stubs (aiofiles) |

### –ù–∞–∏–±–æ–ª–µ–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã:

1. `src/ml/balance_adapter.py` - 15+ –æ—à–∏–±–æ–∫ —Å —Ç–∏–ø–∞–º–∏ –æ–ø–µ—Ä–∞–Ω–¥–æ–≤
2. `src/dmarket/websocket_listener.py` - 6 –æ—à–∏–±–æ–∫ —Å None –æ–ø–µ—Ä–∞–Ω–¥–∞–º–∏
3. `src/dmarket/market_data_logger.py` - 5 –æ—à–∏–±–æ–∫ —Å None –æ–ø–µ—Ä–∞–Ω–¥–∞–º–∏
4. `src/main.py` - 7 –æ—à–∏–±–æ–∫ truthy-bool
5. `src/utils/shutdown_handler.py` - unused-awaitable
6. `src/dmarket/arbitrage_scanner.py` - unused-awaitable

---

## üõ†Ô∏è –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç P0 (–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ):

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
   ```bash
   pip install aiosqlite scikit-learn
   ```

2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å datetime timezone –ø—Ä–æ–±–ª–µ–º—ã**:
   ```python
   # –î–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
   datetime.datetime(2024, 1, 1)  # naive datetime
   datetime.datetime.utcnow()     # deprecated –∏ naive

   # –ü–æ—Å–ª–µ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
   from datetime import datetime, timezone
   datetime.datetime(2024, 1, 1, tzinfo=timezone.utc)  # aware datetime
   datetime.datetime.now(timezone.utc)                  # aware datetime
   ```

3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã notification –º–æ–¥—É–ª–µ–π —Å API**

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç P1 (–í —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏):

4. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å ML –º–æ–¥—É–ª–∏**:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å feature array —Ä–∞–∑–º–µ—Ä—ã
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å sklearn detection logic

5. **–û–±–Ω–æ–≤–∏—Ç—å callback handler —Ç–µ—Å—Ç—ã**

6. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å connection pooling –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é**

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç P2 (–í —Ç–µ—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞):

7. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ deep nesting** (PLR1702):
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å early returns
   - –†–∞–∑–±–∏—Ç—å –Ω–∞ –º–µ–Ω—å—à–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

8. **–£–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ public methods** (PLR0904)

9. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å security warnings** (S104, S301)

10. **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ –∏ —Å—Ç–∏–ª—å pytest**

---

## üìù –§–ê–ô–õ–´ –¢–†–ï–ë–£–Æ–©–ò–ï –í–ù–ò–ú–ê–ù–ò–Ø

### –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥:
- `src/ml/balance_adapter.py` - —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- `src/dmarket/websocket_listener.py` - None checking
- `src/dmarket/market_data_logger.py` - None checking
- `src/main.py` - truthy-bool checks
- `src/dmarket/dmarket_api.py` - —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –º–µ—Ç–æ–¥–æ–≤
- `src/ml/enhanced_predictor.py` - security & types

### –¢–µ—Å—Ç—ã:
- `tests/telegram_bot/notifications/test_checker.py` - API sync
- `tests/telegram_bot/handlers/test_callbacks.py` - handler sync
- `tests/ml/test_model_tuner.py` - sklearn issues
- `tests/analytics/test_data_collector.py` - aiosqlite dependency

---

*–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2026-01-08*
